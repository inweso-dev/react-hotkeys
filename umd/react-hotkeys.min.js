/**
 * ISC License
 *
 * Copyright (c) 2018, Aleck Greenham
 *
 * Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("prop-types"),require("react")):"function"==typeof define&&define.amd?define(["exports","prop-types","react"],t):t((e=e||self).ReactHotkeys={},e.PropTypes,e.React)}(this,function(e,t,r){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var s="default"in r?r.default:r;function o(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p(e,t,n){return(p=f()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);o=new(Function.bind.apply(e,o));return n&&v(o,n.prototype),o}).apply(null,arguments)}function g(e){var n="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return p(e,arguments,d(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),v(t,e)})(e)}function m(e,t){if(null==e)return{};var n,o=function(e,t){if(null==e)return{};for(var n,o={},i=Object.keys(e),r=0;r<i.length;r++)n=i[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),r=0;r<i.length;r++)n=i[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(n){var o=f();return function(){var e,t=d(n);return e=o?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?k(t):e}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function E(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||K(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function S(e){return Array.isArray(e)?e:e?[e]:[]}function I(e){return e}function w(e,t,n,o){var i=!(1<arguments.length&&void 0!==t)||t,r=2<arguments.length&&void 0!==n?n:I,o=3<arguments.length&&void 0!==o?o:{},s="function"==typeof i?i:function(){return i};return S(e).reduce(function(e,t){return e[r(t)]=s(t),e},o)}function P(t){return Object.keys(t).map(function(e){return t[e]})}var H={logLevel:"warn",defaultKeyEvent:"keydown",defaultComponent:"div",defaultTabIndex:"-1",ignoreTags:["input","select","textarea"],ignoreKeymapAndHandlerChangesByDefault:!0,ignoreEventsCondition:function(e){var t=e.target;if(t&&t.tagName){e=t.tagName.toLowerCase();return O.option("_ignoreTagsDict")[e]||t.isContentEditable}return!1},ignoreRepeatedEventsWhenKeyHeldDown:!0,simulateMissingKeyPressEvents:!0,stopEventPropagationAfterHandling:!0,stopEventPropagationAfterIgnoring:!0,allowCombinationSubmatches:!1,customKeyCodes:{}},T=a({},H);T._ignoreTagsDict=w(T.ignoreTags);var O=(c(M,null,[{key:"init",value:function(t){var n=this,e=t.ignoreTags,o=t.customKeyCodes;e&&(t._ignoreTagsDict=w(t.ignoreTags)),o&&(t._customKeyNamesDict=w(P(t.customKeyCodes))),-1!==["verbose","debug","info"].indexOf(t.logLevel)&&console.warn("React HotKeys: You have requested log level '".concat(t.logLevel,"' but for performance reasons, logging below severity level 'warning' is disabled in production. Please use the development build for complete logs.")),Object.keys(t).forEach(function(e){n.set(e,t[e])})}},{key:"set",value:function(e,t){T[e]=t}},{key:"reset",value:function(e){T[e]=H[e]}},{key:"option",value:function(e){return T[e]}}]),M);function M(){u(this,M)}function A(e,t){var n,o=t.deprecatedAPI,i=o.contextTypes,o=o.childContextTypes,t=t.newAPI.contextType;return void 0===s.createContext?(e.contextTypes=i,e.childContextTypes=o,e.prototype.getChildContext=function(){return this._manager.childContext}):(n=s.createContext(t),e.contextType=n,e.prototype._originalRender=e.prototype.render,e.prototype.render=function(){var e=this._originalRender();return e?s.createElement(n.Provider,{value:this._manager.childContext},e):null}),e}function L(e){return void 0===e}var x=(c(F,[{key:"noop",value:function(){}}]),F);function F(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"warn";u(this,F),l(this,"verbose",this.noop),l(this,"debug",this.noop),l(this,"info",this.noop),l(this,"warn",this.noop),l(this,"error",this.noop),this.logLevel=this.constructor.levels[e];for(var t=0,n=["error","warn","info","debug","verbose"];t<n.length;t++){var o=n[t];if(this.logLevel<this.constructor.levels[o])return;this[o]=-1===["debug","verbose"].indexOf(o)?console[o]:console.log}}l(x,"logIcons",["📕","📗","📘","📙"]),l(x,"componentIcons",["🔺","⭐️","🔷","🔶","⬛️"]),l(x,"eventIcons",["❤️","💚","💙","💛","💜","🧡"]),l(x,"levels",{none:0,error:1,warn:2,info:3,debug:4,verbose:5});var D={keydown:0,keypress:1,keyup:2},R=0,j=1,N={"`":["~"],1:["!"],2:["@",'"'],3:["#","£"],4:["$"],5:["%"],6:["^"],7:["&"],8:["*"],9:["("],0:[")"],"-":["_"],"=":["plus"],";":[":"],"'":['"',"@"],",":["<"],".":[">"],"/":["?"],"\\":["|"],"[":["{"],"]":["}"],"#":["~"]};function q(e,t,n){return e[t]||[1===t.length?t[n]():t]}function B(e){return q(N,e,"toUpperCase")}function U(e,t){return e.hasOwnProperty(t)}function z(o,e){var i=1<arguments.length&&void 0!==e?e:{};return Object.keys(o).reduce(function(t,n){var e=o[n];return e.forEach(function(e){U(t,e)||(t[e]=[]),t[e].push(n)}),i.includeOriginal&&(U(t,n)||(t[n]=[]),t[n]=[].concat(E(t[n]),E(e))),t},{})}var W=z(N);function G(e){return q(W,e,"toLowerCase")}var J=z({},{includeOriginal:!0});function $(e){return"string"==typeof e}var V={tab:"Tab",capslock:"CapsLock",shift:"Shift",meta:"Meta",alt:"Alt",ctrl:"Control",space:" ",spacebar:" ",escape:"Escape",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",return:"Enter",del:"Delete",command:"Meta",option:"Alt",enter:"Enter",backspace:"Backspace",ins:"Insert",pageup:"PageUp",pagedown:"PageDown",end:"End",home:"Home",contextmenu:"ContextMenu",numlock:"Clear"},Y={cmd:"Meta"},Q={"`":["`"],1:["⁄"],2:["€"],3:["‹"],4:["›"],5:["ﬁ"],6:["ﬂ"],7:["‡"],8:["°"],9:["·"],0:["‚"],"-":["—"],"=":["±"],a:["Å"],b:["ı"],c:["Ç"],d:["Î"],e:["´"],f:["Ï"],g:["˝"],h:["Ó"],i:["ˆ"],j:["Ô"],k:[""],l:["Ò"],m:["Â"],n:["˜"],o:["Ø"],p:["π"],q:["Œ"],r:["‰"],s:["Í"],t:["Î"],u:["¨"],v:["◊"],w:["„"],x:["˛"],y:["Á"],z:["¸"],"[":["”"],"]":["’"],"\\":["»"],"'":["Æ"],";":["Ú"],",":["¯"],".":["˘"]},X=z(Q);function Z(e){return X[e]||G(e)}function ee(e,t){var n=1<arguments.length&&void 0!==t?t:{shift:!1,alt:!1},t=e.toLowerCase(),e=V[t]||Y[t]||(e.match(/^f\d+$/)?e.toUpperCase():e);return n.shift?(n.alt?Z:G)(e):e}var te={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ne=w(P(te));function oe(e){return!!ne[e]}function ie(e){return oe(e)||String.fromCharCode(e.charCodeAt(0))===e||(e=e,O.option("_customKeyNamesDict")[e])}var re=function(){y(r,g(Error));var i=_(r);function r(){var e;u(this,r);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return l(k(e=i.call.apply(i,[this].concat(n))),"name","InvalidKeyNameError"),e}return r}();function se(e){return Object.keys(e).sort(function(e,t){return e.length!==t.length?t.length-e.length:e<t?-1:t<e?1:0}).join("+")}var ae=(c(ue,null,[{key:"parse",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=($(e=e)?e.trim().replace(/\s+/g," "):e).split(" ");try{var n=e.slice(0,e.length-1),o=e[e.length-1],i=n.map(function(e){return se(ce(e,t))}).join(" "),r=ce(o,t),s={id:se(r),keyDictionary:r,keyEventType:t.keyEventType,size:Object.keys(r).length};return{sequence:{prefix:i,size:n.length+1},combination:s}}catch(e){return{sequence:null,combination:null}}}}]),ue);function ue(){u(this,ue)}function ce(e,t){var n=1<arguments.length&&void 0!==t?t:{},o=-1!==e.indexOf(/[sS]hift/),i=-1!==e.indexOf(/[sS]hift/);return e.replace(/^\+|(\s|[^+]\+)\+/,"$1plus").split("+").reduce(function(e,t){t=ee(t,{shift:o,alt:i});if(n.ensureValidKeys&&!ie(t))throw new re;return e[t]=!0,e},{})}var le={"`":["`"],1:["¡"],2:["™"],3:["£"],4:["¢"],5:["∞"],6:["§"],7:["¶"],8:["•"],9:["ª"],0:["º"],"-":["–"],"=":["≠"],a:["å"],b:["∫"],c:["ç"],d:["∂"],e:["´"],f:["ƒ"],g:["©"],h:["˙"],i:["ˆ"],j:["∆"],k:["˚"],l:["¬"],m:["µ"],n:["˜"],o:["ø"],p:["π"],q:["œ"],r:["®"],s:["ß"],t:["†"],u:["¨"],v:["√"],w:["∑"],x:["≈"],y:["¥"],z:["Ω"],"[":["“"],"]":["‘"],"\\":["«"],"'":["æ"],";":["…"],",":["≤"],".":["≥"],"/":["÷"]},he=z(le);function ye(e){return he[e]||[e]}function de(e){return le[e]||[e]}function ve(e){return Q[e]||[e]}function fe(e){return!Array.isArray(e)&&"object"===n(e)&&null!==e}function pe(e){return(fe(e)?Object.keys(e):e).length}function ge(e,t){var n,o,i=e.Shift,e=e.Alt,t=i?(o=t,e?[].concat(E(ve(o)),E(Z(o)),[o]):[].concat(E(B(o)),E(G(o)),[o])):e?[].concat(E(de(n=t)),E(ye(n)),[n]):(n=J[o=t])?[o].concat(E(n)):[o];return Object.keys(w(t))}var me=(c(ke,null,[{key:"serialize",value:function(e){var t;return(t=e,Object.keys(t).reduce(function(n,e){e=ge(t,e);return 0===pe(n)?e.map(function(e){return l({},e,!0)}):e.reduce(function(e,t){return e.concat(n.map(function(e){return a(a({},e),{},l({},t,!0))}))},[])},[])).map(se)}},{key:"isValidKeySerialization",value:function(e){return 0<e.length&&!!ae.parse(e,{ensureValidKeys:!0}).combination}}]),ke);function ke(){u(this,ke)}function _e(e){return[e]}var be=0,Ee=1,Ke=2,Ce=(c(Se,null,[{key:"newRecord",value:function(e,t){var n=[be,be,be];if(!L(e))for(var o=0;o<=e;o++)n[o]=t;return n}},{key:"setBit",value:function(e,t,n){return e[t]=n,e}},{key:"clone",value:function(e){for(var t=this.newRecord(),n=0;n<e.length;n++)t[n]=e[n];return t}}]),Se);function Se(){u(this,Se)}function Ie(e){return fe(e)?0===Object.keys(e).length:!e||0===e.length}function we(e,t,n){return e[t]||(e[t]="function"==typeof n?n():n),e[t]}var Pe={Shift:["shiftKey"],Meta:["metaKey"],Control:["ctrlKey"],Alt:["altKey"]};function He(e){return e.simulated?Ke:Ee}var Te=(c(Oe,[{key:"ids",get:function(){var e=this;return we(this,"_ids",function(){return me.serialize(e.keyStates)})}},{key:"keyAliases",get:function(){var e=this;return we(this,"_keyAliases",function(){return i=e.keyStates,Object.keys(i).reduce(function(n,o){var e;return(J[e=o]||[e]).forEach(function(t){var e;((e=i).Shift?e.Alt?[ve,Z]:[B,G]:e.Alt?[de,ye]:[_e,_e]).forEach(function(e){e(t).forEach(function(e){e===o&&o===t||(n[e]=o)})})}),n},{});var i})}},{key:"getNormalizedKeyName",value:function(e){if(this.keyStates[e])return e;var t=this.keyAliases[e];return t||e}},{key:"hasEnded",value:function(){return Ie(this.keysStillPressedDict())}},{key:"addKey",value:function(e,t){this._setKeyState(e,[Ce.newRecord(),Ce.newRecord(D.keydown,t)])}},{key:"setKeyState",value:function(e,t,n){var o,i=this._getKeyState(e);this.isKeyIncluded(e)?(o=Ce.clone(i[1]),i=Ce.clone(o),Ce.setBit(i,t,n),this._setKeyState(e,[o,i])):this.addKey(e,n),t===D.keyup&&(this.isEnding=!0)}},{key:"keysStillPressedDict",value:function(){var n=this;return this.keys.reduce(function(e,t){return n.isKeyStillPressed(t)&&(e[t]=n._getKeyState(t)),e},{})}},{key:"isKeyIncluded",value:function(e){return!!this._getKeyState(e)}},{key:"isKeyStillPressed",value:function(e){return this.isEventTriggered(e,D.keypress)&&!this.isKeyReleased(e)}},{key:"isKeyReleased",value:function(e){return this.isEventTriggered(e,D.keyup)}},{key:"isEventTriggered",value:function(e,t){return this._getKeyStateType(e,j,t)}},{key:"wasEventPreviouslyTriggered",value:function(e,t){return this._getKeyStateType(e,R,t)}},{key:"isKeyPressSimulated",value:function(e){return this.isEventTriggered(e,D.keypress)===Ke}},{key:"isKeyUpSimulated",value:function(e){return this.isEventTriggered(e,D.keyup)===Ke}},{key:"resolveModifierFlagDiscrepancies",value:function(o,e,i){var r=this;Object.keys(Pe).forEach(function(t){var n;e===t&&i===D.keyup||(n=r.isKeyStillPressed(t),Pe[t].forEach(function(e){!1===o[e]&&n&&r.setKeyState(t,D.keyup,He(o))}))})}},{key:"keys",get:function(){return Object.keys(this.keyStates)}},{key:"_getKeyStateType",value:function(e,t,n){e=this._getKeyState(e);return e&&e[t][n]}},{key:"_getKeyState",value:function(e){var t=this.keyStates[e];if(t)return t;e=this.keyAliases[e];return e?this.keyStates[e]:void 0}},{key:"_setKeyState",value:function(e,t){e=this.getNormalizedKeyName(e);this.keyStates[e]=t,delete this._keyAliases,delete this._ids}}]),Oe);function Oe(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,Oe),this.keyStates=e,this.isEnding=!1,this._keyAliases=void 0,this._ids=void 0}var Me=(c(Ae,[{key:"describe",value:function(){return this._keyCombination.ids[0]}},{key:"asKeyDictionary",value:function(){return w(this._keyCombination.keys)}},{key:"toJSON",value:function(){return{keys:this._keyCombination.keyStates,ids:this._keyCombination.ids,keyAliases:this._keyCombination.keyAliases}}}]),Ae);function Ae(e){u(this,Ae),this._keyCombination=e}var Le=(c(xe,[{key:"any",value:function(){return 0<this._getKeys().length}},{key:"numberOfKeys",get:function(){return pe(this._getKeys())}},{key:"forEachKey",value:function(e){return this._getKeys().forEach(e)}},{key:"some",value:function(e){return this._getKeys().some(e)}},{key:"_getKeys",value:function(){return this._keyCombination.keys}}]),xe);function xe(e){u(this,xe),this._keyCombination=e}var Fe=(c(De,[{key:"getPreviousCombinations",value:function(e){return this._combinations.slice(-(e+1),-1)}},{key:"any",value:function(){return this._combinations.some(function(e){return new Le(e).any()})}},{key:"length",get:function(){return this._combinations.length}},{key:"currentCombination",get:function(){return this._combinations[this.length-1]}},{key:"addKeyToCurrentCombination",value:function(e,t,n){this._ensureInitialKeyCombination(),this.currentCombination.setKeyState(e,t,n)}},{key:"maxLength",set:function(e){this._maxLength=e,this._trimHistory()}},{key:"startNewKeyCombination",value:function(e,t){this._ensureInitialKeyCombination();var n=new Te(this.currentCombination.keysStillPressedDict());n.addKey(e,t),this._push(n)}},{key:"toJSON",value:function(){return this._combinations.map(function(e){return new Me(e).toJSON()})}},{key:"_ensureInitialKeyCombination",value:function(){0===this.length&&this._push(new Te)}},{key:"_push",value:function(e){this._trimHistory(),this._combinations.push(e)}},{key:"_trimHistory",value:function(){for(;this.length>this._maxLength;)this._shift()}},{key:"_shift",value:function(){this._combinations.shift()}}]),De);function De(e){var t=e.maxLength,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;u(this,De),this._combinations=[],this._maxLength=t,e?this._push(e):this._push(new Te)}var Re=(c(je,[{key:"get",value:function(e){return this._registry[e]}},{key:"set",value:function(e,t){this._registry[e]=t}},{key:"remove",value:function(e){delete this._registry[e]}},{key:"toJSON",value:function(){return this._registry}}]),je);function je(){u(this,je),this._registry={}}var Ne=function(){y(o,Re);var t=_(o);function o(){var e;return u(this,o),(e=t.call(this)).clearRootId(),e}return c(o,[{key:"hasRoot",value:function(){return!this.isRootId(null)}},{key:"isRootId",value:function(e){return e===this.rootId}},{key:"clearRootId",value:function(){this.rootId=null}},{key:"add",value:function(e,t){b(d(o.prototype),"set",this).call(this,e,{childIds:[],parentId:null,keyMap:t})}},{key:"update",value:function(e,t){var n=b(d(o.prototype),"get",this).call(this,e);b(d(o.prototype),"set",this).call(this,e,a(a({},n),{},{keyMap:t}))}},{key:"setParent",value:function(e,t){L(t)?this.rootId=e:(this.get(e).parentId=t,this._addChildId(t,e))}},{key:"remove",value:function(e){var t=this._getParentId(e);this._removeChildId(t,e),b(d(o.prototype),"remove",this).call(this,e)}},{key:"_getParentId",value:function(e){e=this.get(e);return e&&e.parentId}},{key:"_addChildId",value:function(e,t){this.get(e).childIds.push(t)}},{key:"_removeChildId",value:function(e,t){e=this.get(e);e&&(e.childIds=function(n,e,t){var e=1<arguments.length&&void 0!==e?e:[],o=2<arguments.length&&void 0!==t?t:{},i=w(S(e),function(e){return{value:e}});return Array.isArray(n)?n.reduce(function(e,t){return i[t]&&(o.stringifyFirst||i[t].value===t)||e.push(t),e},[]):fe(n)?Object.keys(n).reduce(function(e,t){return i[t]||(e[t]=n[t]),e},{}):n}(e.childIds,t))}}]),o}();var qe=(c(Be,[{key:"getComponent",value:function(){return this._list.getAtPosition(this.position)}},{key:"next",value:function(){return this.position+1<this._list.length?(this.position++,this.getComponent()):null}}]),Be);function Be(e){u(this,Be),this._list=e,this.position=-1}var Ue=(c(ze,[{key:"iterator",get:function(){return new qe(this)}},{key:"add",value:function(e,t,n,o){if(this.containsId(e))return this.update(e,t,n,o);o=this._build(e,t,n,o);this._list.push(o);o=this.length-1;return this._idToIndex[e]=o}},{key:"containsId",value:function(e){return!!this.getById(e)}},{key:"getById",value:function(e){return this.getAtPosition(this.getPositionById(e))}},{key:"getPositionById",value:function(e){return this._idToIndex[e]}},{key:"update",value:function(e,t,n,o){var i=this._isUpdatingComponentWithLongestSequence(e),r=this.longestSequence,o=this._build(e,t,n,o);i&&o.sequenceLength!==r&&(o.sequenceLength>r?this.longestSequence=o.sequenceLength:this._recalculateLongestSequence()),this._list[this.getPositionById(e)]=o}},{key:"remove",value:function(e){var t=this._isUpdatingComponentWithLongestSequence(e);this.removeAtPosition(this.getPositionById(e)),t&&this._recalculateLongestSequence()}},{key:"isRoot",value:function(e){return this.getPositionById(e)>=this.length-1}},{key:"anyActionsForEventType",value:function(e){return!!this._keyMapEventRecord[e]}},{key:"length",get:function(){return this._list.length}},{key:"getAtPosition",value:function(e){return this._list[e]}},{key:"removeAtPosition",value:function(e){var t,n;this._list=(t=this._list,n=e,[].concat(E(t.slice(0,n)),E(t.slice(n+1))));for(var o=e;o<this.length;)this._idToIndex[this.getAtPosition(o).componentId]=o,o++}},{key:"toJSON",value:function(){return this._list}},{key:"_build",value:function(e,t,n,o){return{actions:this._buildActionDictionary(t,o,e),handlers:n,componentId:e,options:o}}},{key:"_isUpdatingComponentWithLongestSequence",value:function(e){return e===this._getLongestSequenceComponentId()}},{key:"_getLongestSequenceComponentId",value:function(){return this._longestSequenceComponentId}},{key:"_recalculateLongestSequence",value:function(){for(var e=this.iterator;e.next();){var t=e.getComponent(),n=t.longestSequence,t=t.componentId;n>this.longestSequence&&(this._longestSequenceComponentId=t,this.longestSequence=n)}}},{key:"_buildActionDictionary",value:function(t,i,r){var s=this;return Object.keys(t).reduce(function(n,o){var e=t[o];return(fe(e)&&U(e,"sequences")?S(e.sequences):S(e)).forEach(function(e){var t=function(e,t){{if(fe(e)){var n=e.sequence,o=e.action;return{keySequence:n,keyEventType:L(o)?D[t.defaultKeyEvent]:D[o]}}return{keySequence:e,keyEventType:D[t.defaultKeyEvent]}}}(e,i),e=t.keySequence,t=t.keyEventType;s._addActionOptions(n,r,o,e,t)}),n},{})}},{key:"_addActionOptions",value:function(e,t,n,o,i){var r=ae.parse(o,{keyEventType:i}),o=r.sequence,r=r.combination;o.size>this.longestSequence&&(this.longestSequence=o.size,this._longestSequenceComponentId=t),this._keyMapEventRecord[i]=Ee,e[n]||(e[n]=[]),e[n].push(a({prefix:o.prefix,actionName:n,sequenceLength:o.size},r))}}]),ze);function ze(){u(this,ze),this._list=[],this._idToIndex={},this.longestSequence=1,this._longestSequenceComponentId=null,this._keyMapEventRecord=Ce.newRecord()}function We(e,t){return e[e.length-(t+1)]}for(var Ge={Enter:!0,Backspace:!0,ArrowRight:!0,ArrowLeft:!0,ArrowUp:!0,ArrowDown:!0,CapsLock:!0},Je=1;Je<13;Je++)Ge["F".concat(Je)]=!0;function $e(e){return 1===e.length||U(Ge,e)}var Ve=(c(Ye,[{key:"addMatch",value:function(e,t){var n,o,i;this._includesMatcherForCombination(e.id)?(n=e.keyEventType,o=e.actionName,i=e.id,this._addHandlerToActionConfig(i,{keyEventType:n,actionName:o,handler:t})):this._addNewActionConfig(e,t)}},{key:"findMatch",value:function(e,t,n){var o=this;we(this,"order",function(){return o._setOrder()});var i,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=K(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,i=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw i}}}}(this._order);try{for(r.s();!(i=r.n()).done;){var s=i.value,a=this._actionConfigs[s];if(this._matchesActionConfig(e,t,n,a))return a}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"toJSON",value:function(){return{actionConfigs:this._actionConfigs,order:this._order}}},{key:"_matchesActionConfig",value:function(t,n,o,e){if(i=t,s=pe((r=e).keyDictionary),r=new Le(i),!(O.option("allowCombinationSubmatches")||function(e){if(e.isKeyStillPressed("Meta"))return new Le(e).some($e);return!1}(i)?r.numberOfKeys>=s:r.numberOfKeys===s)||!e.events[o])return!1;var i,r,s,a=!1;return Object.keys(e.keyDictionary).every(function(e){return!!t.isEventTriggered(e,o)&&(n&&n===t.getNormalizedKeyName(e)&&(a=!t.wasEventPreviouslyTriggered(e,o)),!0)})&&a}},{key:"_setOrder",value:function(){var n=P(this._actionConfigs).reduce(function(e,t){var n=t.id,t=t.size;return e[t]||(e[t]=[]),e[t].push(n),e},{});this._order=Object.keys(n).sort(function(e,t){return t-e}).reduce(function(e,t){return e.concat(n[t])},[])}},{key:"_addNewActionConfig",value:function(e,t){var n=e.prefix,o=e.sequenceLength,i=e.id,r=e.keyDictionary,s=e.size,a=e.keyEventType,e=e.actionName;this._setCombinationMatcher(i,{prefix:n,sequenceLength:o,id:i,keyDictionary:r,size:s,events:{}}),this._addHandlerToActionConfig(i,{keyEventType:a,actionName:e,handler:t})}},{key:"_addHandlerToActionConfig",value:function(e,t){var n=t.keyEventType,o=t.actionName,i=t.handler,t=this._getCombinationMatcher(e);this._setCombinationMatcher(e,a(a({},t),{},{events:a(a({},t.events),{},l({},n,{actionName:o,handler:i}))}))}},{key:"_setCombinationMatcher",value:function(e,t){this._actionConfigs[e]=t}},{key:"_getCombinationMatcher",value:function(e){return this._actionConfigs[e]}},{key:"_includesMatcherForCombination",value:function(e){return!!this._getCombinationMatcher(e)}}]),Ye);function Ye(){u(this,Ye),this._actionConfigs={},this._order=null}var Qe=(c(Xe,[{key:"addMatch",value:function(e,t){this._getOrCreateCombinationMatcher(e.prefix).addMatch(e,t),Ce.setBit(this._eventRecord,e.keyEventType,Ee),(!this.longestSequence||this.longestSequence<e.sequenceLength)&&(this.longestSequence=e.sequenceLength)}},{key:"findMatch",value:function(e,t,n){var o=this._findCombinationMatcher(e);return o?o.findMatch(e.currentCombination,e.currentCombination.getNormalizedKeyName(t),n):null}},{key:"hasMatchesForEventType",value:function(e){return!!this._eventRecord[e]}},{key:"toJSON",value:function(){var o=this;return Object.keys(this._combinationMatchers).reduce(function(e,t){var n=o._combinationMatchers[t];return e[t]=n.toJSON(),e},{})}},{key:"_getOrCreateCombinationMatcher",value:function(e){return we(this._combinationMatchers,e,function(){return new Ve})}},{key:"_findCombinationMatcher",value:function(e){e=e.getPreviousCombinations(this.longestSequence-1);if(0===e.length)return this._combinationMatchers[""];var n=e.map(function(e){return e.ids}),t=n.map(function(e){return e.length}),o=new Array(n.length).fill(0);do{var i=o.map(function(e,t){return n[t][e]}).join(" ");if(this._combinationMatchers[i])return this._combinationMatchers[i]}while(!function(e,t){for(var n=0,o=!0;o&&n<e.length;){var i=(We(e,n)+1)%(We(t,n)||1);(o=0==(e[e.length-(n+1)]=i))&&n++}return n===e.length}(o,t));return this._combinationMatchers[""]}}]),Xe);function Xe(){u(this,Xe),this._combinationMatchers={},this._eventRecord=Ce.newRecord()}function Ze(e){return JSON.stringify(e,et,4)}function et(e,t){return"function"==typeof t?t.toString():t}function tt(e){switch(parseInt(e,10)){case 0:return"keydown";case 1:return"keypress";default:return"keyup"}}var nt=(c(ot,[{key:"getKeyHistoryMatcher",value:function(e){if(this._componentHasUnmatchedHandlers(e))for(;this._componentListIterator.next();)this._addHandlersFromComponent(),this._addActionsFromComponent();return this._getKeyHistoryMatcher(e)}},{key:"componentHasActionsBoundToEventType",value:function(e,t){return this.getKeyHistoryMatcher(e).hasMatchesForEventType(t)}},{key:"findMatchingKeySequenceInComponent",value:function(e,t,n,o){return this.componentHasActionsBoundToEventType(e,o)?this.getKeyHistoryMatcher(e).findMatch(t,n,o):null}},{key:"callClosestMatchingHandler",value:function(e,t,n,o,i){for(;i<=o;){this.getKeyHistoryMatcher(i);var r=this._eventStrategy.componentList.getAtPosition(i).componentId,s=this._eventStrategy.keyHistory,a=s.currentCombination,s=this.findMatchingKeySequenceInComponent(i,s,t,n);if(s)return this._handleMatchFound(a,s,n,r,e,i),!0;this._handleMatchNotFound(a,i,n,r),i++}}},{key:"_handleMatchNotFound",value:function(e,t,n,o){new Me(e);this.componentHasActionsBoundToEventType(t,n)}},{key:"_handleMatchFound",value:function(e,t,n,o,i,r){new Me(e);n=t.events[n];O.option("allowCombinationSubmatches")&&me.serialize(t.keyDictionary),n.handler(i),O.option("stopEventPropagationAfterHandling")&&this._eventStrategy.stopEventPropagation(i,r)}},{key:"_getKeyHistoryMatcher",value:function(e){return this._keyMapMatchers[e]}},{key:"_addActionsFromComponent",value:function(){var t=this,n=this._componentListIterator.getComponent().actions;Object.keys(n).forEach(function(e){t._buildActionMatchers(e,n[e])})}},{key:"_buildActionMatchers",value:function(n,e){var o=this,t=this._positionsOfComponentsWithHandlersFor(n);return!!t&&(this._registerActionWithMatcher(t,n,e),t.forEach(function(e){var t=o._getUnmatchedHandlerStatus(e),e=t[1];e[n]||(e[n]=!0,t[0]--)}),!0)}},{key:"_positionsOfComponentsWithHandlersFor",value:function(e){return this._handlersDictionary[e]}},{key:"_registerActionWithMatcher",value:function(e,t,n){var i=this,r=e[0],s=this._componentList.getAtPosition(r).handlers[t],a=this._getKeyHistoryMatcher(r);return n.forEach(function(e){var t=e.prefix,n=e.id,o=e.keyEventType,n=[t,n].join(" ");if(i._isClosestHandlerAlreadyFoundFor(n,o))return!1;a.addMatch(e,s),i._recordHandlerFoundFor(n,[r,o])}),!0}},{key:"_addHandlersFromComponent",value:function(){var t=this,e=this._componentListIterator.getComponent().handlers;Object.keys(e).forEach(function(e){t._addHandler(e)})}},{key:"_addHandler",value:function(e){we(this._handlersDictionary,e,[]),this._handlersDictionary[e].push(this._componentListIterator.position)}},{key:"_recordHandlerFoundFor",value:function(e,t){we(this._keySequencesDictionary,e,[]),this._keySequencesDictionary[e].push(t)}},{key:"_componentHasUnmatchedHandlers",value:function(e){return 0<this._getUnmatchedHandlerStatus(e)[0]}},{key:"_getUnmatchedHandlerStatus",value:function(e){return this._unmatchedHandlerStatus[e]}},{key:"_isClosestHandlerAlreadyFoundFor",value:function(e,t){return(this._keySequencesDictionary[e]||[]).some(function(e){return e[1]===t})}}]),ot);function ot(e,t,n){u(this,ot),this.logger=n,this._eventStrategy=t,this._keyMapMatchers=[],this._unmatchedHandlerStatus=[],this._handlersDictionary={},this._keySequencesDictionary={};for(var o=e.iterator;o.next();){var i=o.getComponent().handlers;this._unmatchedHandlerStatus.push([Object.keys(i).length,{}]),this._keyMapMatchers.push(new Qe)}this._componentList=e,this._componentListIterator=e.iterator}var it=(c(rt,[{key:"_reset",value:function(){this.componentList=new Ue,this._actionResolver=null}},{key:"_recalculate",value:function(){this._actionResolver=null,this.keyHistory.maxLength=this.componentList.longestSequence}},{key:"keyHistory",get:function(){var e=this;return we(this,"_keyHistory",function(){return e._newKeyHistory()})}},{key:"actionResolver",get:function(){var e=this;return we(this,"_actionResolver",function(){return new nt(e.componentList,e,e.logger)})}},{key:"resetKeyHistory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._simulator&&this._simulator.clear(),this.keyHistory.any()&&!e.force?this._keyHistory=new Fe({maxLength:this.componentList.longestSequence},new Te(this)):this._keyHistory=this._newKeyHistory()}},{key:"_newKeyHistory",value:function(){return new Fe({maxLength:this.componentList.longestSequence})}},{key:"registerKeyMap",value:function(e){return this.componentId+=1,this.componentTree.add(this.componentId,e),this.componentId}},{key:"reregisterKeyMap",value:function(e,t){this.componentTree.update(e,t)}},{key:"registerComponentMount",value:function(e,t){this.componentTree.setParent(e,t)}},{key:"deregisterKeyMap",value:function(e){this.componentTree.remove(e),this.componentTree.isRootId(e)&&this.componentTree.clearRootId()}},{key:"_addComponent",value:function(e){this.componentList.add(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},4<arguments.length?arguments[4]:void 0),this._recalculate(),this.logger.logComponentOptions(e,this.componentList.getById(e))}},{key:"_updateComponent",value:function(e,t,n,o){this.componentList.update(e,t,n,o),this._recalculate(),this.logger.logComponentOptions(e,this.componentList.getById(e))}},{key:"currentCombination",get:function(){return this.keyHistory.currentCombination}},{key:"_describeCurrentCombination",value:function(){return new Me(this.currentCombination).describe()}},{key:"_recordKeyDown",value:function(e,t,n){var o=He(e),e=this.currentCombination;e.isKeyIncluded(t)||e.isEnding?this._startAndLogNewKeyCombination(n,t,o):this._recordNewKeyInCombination(t,D.keydown,o,n)}},{key:"_startAndLogNewKeyCombination",value:function(e,t,n){this.keyHistory.startNewKeyCombination(t,n),this.logger.logKeyHistory(this.keyHistory,e)}},{key:"_recordNewKeyInCombination",value:function(e,t,n,o){this.keyHistory.addKeyToCurrentCombination(e,t,n),this.logger.logKeyHistory(this.keyHistory,o)}},{key:"_isIgnoringRepeatedEvent",value:function(e,t,n,o){return!(!e.repeat||!O.option("ignoreRepeatedEventsWhenKeyHeldDown"))&&(this.logger.logIgnoredKeyEvent(e,t,n,"it was a repeated event",o),!0)}}]),rt);function rt(){var e=1<arguments.length?arguments[1]:void 0;u(this,rt),this.logger=null,this.componentId=-1,this.keyEventManager=e,this.componentTree=new Ne,this._simulator=null,this._reset(),this.resetKeyHistory()}var st={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"};function at(e){var t=O.option("customKeyCodes"),n=e.keyCode||e.charCode;return U(t,n)?t[n]:e.nativeEvent?e.key:function(e){if(e.key){var t=st[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"!==e.type)return"keydown"===e.type||"keyup"===e.type?te[e.keyCode]||"Unidentified":"";var n=(e=(t=e).keyCode,"charCode"in t?0===(n=t.charCode)&&13===e&&(n=13):n=e,32<=(n=10===n?13:n)||13===n?n:0);return 13===n?"Enter":String.fromCharCode(n)}(e)}function ut(e){e=at(e);return"+"===e?"plus":e}function ct(e){return"Meta"===e}function lt(e,t,n){n="'".concat(t,"' ").concat(tt(n));return e.simulated?"(simulated) ".concat(n):n}var ht=0,yt=1,dt=2,vt=4,ft=(c(pt,null,[{key:"id",get:function(){return we(this,"_id",0),this._id}},{key:"incrementId",value:function(){this._id=this.id+1}}]),pt);function pt(){u(this,pt)}var gt=(c(mt,[{key:"_reset",value:function(){this.previousPosition=-1,this._position=-1,this._actionHandled=!1,this._ignoreEvent=!1,this._observeIgnoredEvents=!1,this._stopping=!1,this._componentId=null,this._key=null,this._type=null}},{key:"isFirstPropagationStep",value:function(){var e=this.previousPosition;return-1===e||e>=this._position}},{key:"isForKey",value:function(e){return this._key===e}},{key:"isForEventType",value:function(e){return this._type===e}},{key:"startNewPropagationStep",value:function(e,t,n,o){return this._position=this._componentList.getPositionById(e),this._componentId=e,this.isFirstPropagationStep()&&(ft.incrementId(),this._key=t.key,this._type=o),!t.repeat||!O.option("ignoreRepeatedEventsWhenKeyHeldDown")||(this.ignoreEvent(t),!1)}},{key:"finishPropagationStep",value:function(){this.isStopped()||this._componentList.isRoot(this._componentId)?(this._previousPropagation=this._clone(),this._reset()):this.previousPosition=this._position}},{key:"previousPropagation",get:function(){var e=this;return we(this,"_previousPropagation",function(){return e._clone({copyState:!1})})}},{key:"observeIgnoredEvents",value:function(){this._observeIgnoredEvents=!0}},{key:"ignoreEvent",value:function(e){return this._ignoreEvent=!0,!(!this.isIgnoringEvent()||!O.option("stopEventPropagationAfterIgnoring"))&&(this.stop(e),this.finishPropagationStep(),!0)}},{key:"isIgnoringEvent",value:function(){return!this._observeIgnoredEvents&&this._ignoreEvent}},{key:"isStopped",value:function(){return this._stopping}},{key:"stop",value:function(e){return!this.isStopped()&&(this._stopping=!0,e.simulated||e.stopPropagation(),!0)}},{key:"isPendingPropagation",value:function(){var e=this.previousPosition;return-1!==e&&e+1<this._position}},{key:"isHandled",value:function(){return this._actionHandled}},{key:"setHandled",value:function(){this._actionHandled=!0}},{key:"_clone",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).copyState,t=void 0===e||e,e=new mt(this._componentList);return e.logger=this.logger,t&&Object.assign(e,this),e}}]),mt);function mt(e){u(this,mt),this._componentList=e,this._previousPropagation=null,this._reset()}var kt=(c(_t,[{key:"clear",value:function(){this.keypressEventsToSimulate=[],this.keyupEventsToSimulate=[]}},{key:"cloneAndMergeEvent",value:function(n,e){return a(a({},Object.keys(Pe).reduce(function(e,t){return e[t]=n[t],e},{})),e)}},{key:"_shouldSimulate",value:function(e,t){var n=!oe(t),o=this._keyEventStrategy.currentCombination;return e===D.keypress?!n||n&&o.isKeyStillPressed("Meta"):e===D.keyup&&($e(t)&&o.isKeyReleased("Meta"))}}]),_t);function _t(e){u(this,_t),this._keyEventStrategy=e,this.clear()}var bt=function(){y(t,kt);var e=_(t);function t(){return u(this,t),e.apply(this,arguments)}return c(t,[{key:"handleKeyPressSimulation",value:function(e){this._handleEventSimulation("keypressEventsToSimulate","simulatePendingKeyPressEvents",a({eventType:D.keypress},e))}},{key:"handleKeyUpSimulation",value:function(e){this._handleEventSimulation("keyupEventsToSimulate","simulatePendingKeyUpEvents",a({eventType:D.keyup},e))}},{key:"_handleEventSimulation",value:function(e,t,n){var o=n.event,i=n.eventType,r=n.key,s=n.focusTreeId,a=n.componentId,n=n.options;this._shouldSimulate(i,r)&&O.option("simulateMissingKeyPressEvents")&&(r=this.cloneAndMergeEvent(o,{key:r,simulated:!0}),this[e].push({event:r,focusTreeId:s,componentId:a,options:n})),(this._keyEventStrategy.componentList.isRoot(a)||this._keyEventStrategy.eventPropagator.isStopped())&&this._shouldSimulateEventsImmediately()&&this._keyEventStrategy[t]()}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulatePendingKeyEvents("keypressEventsToSimulate","handleKeyPress")}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulatePendingKeyEvents("keyupEventsToSimulate","handleKeyUp")}},{key:"_simulatePendingKeyEvents",value:function(e,i){var r=this;0<this[e].length&&ft.incrementId(),this[e].forEach(function(e){var t=e.event,n=e.focusTreeId,o=e.componentId,e=e.options;r._keyEventStrategy[i](t,n,o,e)}),this[e]=[]}},{key:"_shouldSimulateEventsImmediately",value:function(){return this._keyEventStrategy.shouldSimulateEventsImmediately()}}]),t}(),Et=(c(Kt,[{key:"isNewerThan",value:function(e){return this.id!==e}},{key:"new",value:function(){this.id+=1}}]),Kt);function Kt(){u(this,Kt),this.id=0}var Ct=function(){y(o,x);var n=_(o);function o(e,t){return u(this,o),(e=n.call(this,e))._eventStrategy=t,e}return c(o,[{key:"nonKeyEventPrefix",value:function(e){return this.keyEventPrefix(e,a(a({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}),{},{eventId:!1}))}},{key:"logComponentOptions",value:function(e,t){this.verbose(this.nonKeyEventPrefix(e),"New component options:\n",Ze(t))}},{key:"logKeyHistory",value:function(e,t){this.verbose(this.keyEventPrefix(t),"Key history: ".concat(Ze(e.toJSON()),"."))}}]),o}(),St=function(){y(a,Ct);var e=_(a);function a(){return u(this,a),e.apply(this,arguments)}return c(a,[{key:"keyEventPrefix",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=b(d(a.prototype),"constructor",this).logIcons,i=b(d(a.prototype),"constructor",this).eventIcons,r=b(d(a.prototype),"constructor",this).componentIcons,s="HotKeys (";!1!==n.focusTreeId&&(t=(L(n.focusTreeId)?this._eventStrategy:n).focusTreeId,s+="F".concat(t).concat(o[t%o.length],"-")),s+="C".concat(e).concat(r[e%r.length]);e=this._eventStrategy.componentList.getPositionById(e);return L(e)||(s+="-P".concat(e).concat(r[e%r.length])),!1!==n.eventId&&(n=L(n.eventId)?ft.id:n.eventId,s+="-E".concat(n).concat(i[n%i.length])),"".concat(s,"):")}},{key:"logIgnoredKeyEvent",value:function(e,t,n,o,i){this.logIgnoredEvent(lt(e,t,n),o,i)}},{key:"logIgnoredEvent",value:function(e,t,n){this.debug(this.keyEventPrefix(n),"Ignored ".concat(e," because ").concat(t,"."))}},{key:"logAlreadySimulatedEvent",value:function(e,t,n,o){this.logIgnoredKeyEvent(e,t,n,"it was not expected, and has already been simulated",o)}}]),a}(),It=function(){y(o,it);var n=_(o);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return u(this,o),(t=n.call(this,e,t)).logger=new St(e.logLevel||"warn",k(t)),t.eventPropagator.logger=t.logger,t.focusTree=new Et,t._simulator=new bt(k(t)),t}return c(o,[{key:"_reset",value:function(){b(d(o.prototype),"_reset",this).call(this),this._simulator&&this._simulator.clear(),this.focusTree&&this.focusTree.new(),this.eventPropagator=new gt(this.componentList),this.eventPropagator.logger=this.logger}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;if(this.resetOnNextFocus&&(this._reset(),this.resetOnNextFocus=!1),!this.componentList.containsId(e))return this._addComponent(e,t,n,"Focused",o),this.focusTree.id}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;!this.focusTree.isNewerThan(e)&&this.componentList.containsId(t)&&this._updateComponent(t,n,o,i)}},{key:"disableHotKeys",value:function(e,t){return this.resetOnNextFocus=!0,this.eventPropagator.isPendingPropagation()}},{key:"handleKeyDown",value:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=ut(e);return this.focusTree.isNewerThan(t)?(this.logger.logIgnoredKeyEvent(e,i,D.keydown,"it had an old focus tree id: ".concat(t),n),this.eventPropagator.ignoreEvent(e),!0):(this._isIgnoringRepeatedEvent(e,i,D.keydown,n)||this.eventPropagator.startNewPropagationStep(n,e,i,D.keydown)&&(this._howToHandleKeyEvent(e,t,n,i,o,D.keydown)===vt&&(this._recordKeyDown(e,i,n),this._callHandlerIfActionNotHandled(e,i,D.keydown,n,t)),this._simulator.handleKeyPressSimulation({event:e,key:i,focusTreeId:t,componentId:n,options:o}),this.eventPropagator.finishPropagationStep()),!1)}},{key:"_howToHandleKeyEvent",value:function(e,t,n,o,i,r){if(this.eventPropagator.isFirstPropagationStep()){if(i.ignoreEventsCondition(e)&&this.eventPropagator.ignoreEvent(e))return this._eventIsToBeIgnored(e,n,o,r);this.currentCombination.resolveModifierFlagDiscrepancies(e,o,r)}else if(this.eventPropagator.isIgnoringEvent())return this._eventIsToBeIgnored(e,n,o,r);return vt}},{key:"_eventIsToBeIgnored",value:function(e,t,n,o){return this.logger.logIgnoredKeyEvent(e,n,o,"ignoreEventsFilter rejected it",t),yt}},{key:"handleKeyPress",value:function(e,t,n,o){var i=ut(e);if(this._isIgnoringRepeatedEvent(e,i,D.keypress,n))return!1;if(this.currentCombination.isKeyPressSimulated(i))return this._ignoreAlreadySimulatedEvent(e,i,D.keypress,n),!1;var r=this.focusTree.isNewerThan(t);return this.eventPropagator.startNewPropagationStep(n,e,i,D.keypress)&&(o=this._howToHandleKeyEvent(e,t,n,i,o,D.keypress),this.eventPropagator.isFirstPropagationStep(n)&&this.currentCombination.isKeyIncluded(i)&&this._recordNewKeyInCombination(i,D.keypress,He(e),n),o===vt&&this._callHandlerIfActionNotHandled(e,i,D.keypress,n,t),this.eventPropagator.finishPropagationStep()),r}},{key:"handleKeyUp",value:function(e,t,n,o){var i=ut(e);if(this.currentCombination.isKeyUpSimulated(i))return this._ignoreAlreadySimulatedEvent(e,i,D.keyup,n),!1;var r,s=this.focusTree.isNewerThan(t),a=this.eventPropagator;return a.startNewPropagationStep(n,e,i,D.keyup)&&(r=this._howToHandleKeyEvent(e,t,n,i,o,D.keyup),a.isFirstPropagationStep(n)&&this.currentCombination.isKeyIncluded(i)&&this._recordNewKeyInCombination(i,D.keyup,He(e),n),r===vt&&this._callHandlerIfActionNotHandled(e,i,D.keyup,n,t),this._simulateKeyUpEventsHiddenByCmd(e,i,t,n,o),a.finishPropagationStep()),s}},{key:"_ignoreAlreadySimulatedEvent",value:function(e,t,n,o){this.logger.logAlreadySimulatedEvent(e,t,n,o),this.eventPropagator.ignoreEvent(e)}},{key:"closeHangingKeyCombination",value:function(e,t){var n=this.currentCombination;n.isKeyIncluded(e)&&!n.isEventTriggered(e,t)&&n.setKeyState(e,t,Ke)}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e,n,o,i){var r=this;ct(e)&&new Le(this.currentCombination).forEachKey(function(e){ct(e)||r._simulator.handleKeyUpSimulation({event:t,key:e,focusTreeId:n,componentId:o,options:i})})}},{key:"stopEventPropagation",value:function(e,t){this.eventPropagator.stop(e)}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulator.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulator.simulatePendingKeyUpEvents()}},{key:"shouldSimulateEventsImmediately",value:function(){return!this.keyEventManager.isGlobalListenersBound()}},{key:"_callHandlerIfActionNotHandled",value:function(e,t,n,o,i){var r,s,a=tt(n),u=this._describeCurrentCombination();this.componentList.anyActionsForEventType(n)?this.eventPropagator.isHandled()?this.logger.logIgnoredEvent("'".concat(u,"' ").concat(a),"it has already been handled",o):(r=this.eventPropagator.previousPosition,s=this.componentList.getPositionById(o),this.actionResolver.callClosestMatchingHandler(e,t,n,s,-1===r?0:r)&&this.eventPropagator.setHandled()):this.logger.logIgnoredEvent("'".concat(u,"' ").concat(a),"it doesn't have any ".concat(a," handlers"),o)}}]),o}();function wt(e,t,n){var o,i=2<arguments.length&&void 0!==n?n:{};return Array.isArray(e)||$(e)?(n=e,o=t,i.stringifyFirst?!L(n.find(function(e){return e.toString()===o.toString()})):-1!==n.indexOf(o)):fe(e)?U(e,t):(e=e,t=t,i.stringifyFirst?e.toString()===t.toString():e===t)}var Pt=function(){y(t,kt);var e=_(t);function t(){return u(this,t),e.apply(this,arguments)}return c(t,[{key:"handleKeyPressSimulation",value:function(e){this._handleEventSimulation("handleKeyPress",a({eventType:D.keypress},e))}},{key:"handleKeyUpSimulation",value:function(e){this._handleEventSimulation("handleKeyUp",a({eventType:D.keyup},e))}},{key:"_handleEventSimulation",value:function(e,t){var n=t.event,o=t.eventType,t=t.key;this._shouldSimulate(o,t)&&O.option("simulateMissingKeyPressEvents")&&(t=this.cloneAndMergeEvent(n,{key:t,simulated:!0}),this._keyEventStrategy[e](t))}}]),t}();function Ht(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}var Tt=(c(Ot,[{key:"isListenersBound",value:function(){return this._listenersBound}},{key:"unbindListeners",value:function(){var t=this;P(D).forEach(function(e){e=tt(e);delete document["on".concat(e)],t._logHandlerStateChange("Removed",e)}),this._listenersBound=!1}},{key:"bindListeners",value:function(){var o=this;P(D).forEach(function(e){var n=tt(e);document["on".concat(n)]=function(e){var t;o._eventStrategy["handle".concat("".concat(Ht((t=n).slice(0,3))).concat(Ht(t.slice(3))))](e)},o._logHandlerStateChange("Bound",n)}),this._listenersBound=!0}},{key:"_logHandlerStateChange",value:function(e,t){}}]),Ot);function Ot(e,t){t=t.logger;u(this,Ot),this._listenersBound=!1,this.logger=t,this._eventStrategy=e}var Mt=function(){y(r,Ct);var e=_(r);function r(){return u(this,r),e.apply(this,arguments)}return c(r,[{key:"keyEventPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=b(d(r.prototype),"constructor",this).eventIcons,o=b(d(r.prototype),"constructor",this).componentIcons,i="HotKeys (GLOBAL";if(!L(e))return"".concat(i,"-C").concat(e).concat(o[e%o.length],"):");if(!1===t.eventId)return"".concat(i,"):");t=L(t.eventId)?ft.id:t.eventId;return"".concat(i,"-E").concat(t).concat(n[t%n.length],"):")}},{key:"logIgnoredKeyEvent",value:function(e,t,n,o,i){this.logIgnoredEvent(lt(e,t,n),o,i)}},{key:"logIgnoredEvent",value:function(e,t,n){this.debug(this.keyEventPrefix(n),"Ignored ".concat(e," because ").concat(t,"."))}},{key:"logEventRejectedByFilter",value:function(e,t,n,o){this.logIgnoredKeyEvent(e,t,n,"ignoreEventsFilter rejected it",o)}},{key:"logEventAlreadySimulated",value:function(e,t,n,o){this.logIgnoredKeyEvent(e,t,n,"it was not expected, and has already been simulated",o)}}]),r}(),At=function(){y(o,it);var n=_(o);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return u(this,o),(t=n.call(this,e,t)).logger=new Mt(e.logLevel||"warn",k(t)),t.eventOptions={ignoreEventsCondition:O.option("ignoreEventsCondition")},t.listeners=new Re,t._simulator=new Pt(k(t)),t._listenerAdaptor=new Tt(k(t),{logger:t.logger}),t}return c(o,[{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;this.eventOptions=4<arguments.length?arguments[4]:void 0,this._addComponent(e,t,n,"Mounted",o)}},{key:"updateEnabledHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;this.eventOptions=4<arguments.length?arguments[4]:void 0,this._updateComponent(e,t,n,o)}},{key:"disableHotKeys",value:function(e){this.componentList.remove(e),this._recalculate()}},{key:"_recalculate",value:function(){b(d(o.prototype),"_recalculate",this).call(this),this._updateDocumentHandlers()}},{key:"_updateDocumentHandlers",value:function(){var e=this._shouldListenersBeBound(),t=this.isListenersBound();!t&&e?this._listenerAdaptor.bindListeners():t&&!e&&this._listenerAdaptor.unbindListeners()}},{key:"isListenersBound",value:function(){return this._listenerAdaptor.isListenersBound()}},{key:"_shouldListenersBeBound",value:function(){return 0!==this.componentList.length||this.listeners.get("keyCombination")}},{key:"handleKeyDown",value:function(e){var t,n=ut(e);this._isIgnoringRepeatedEvent(e,n,D.keydown)||(this.currentCombination.resolveModifierFlagDiscrepancies(e,n,D.keydown),(t=this._howReactAppRespondedTo(e,n,D.keydown))===ht&&this.eventOptions.ignoreEventsCondition(e)?this.logger.logEventRejectedByFilter(e,n,D.keydown):(t!==yt&&this._recordKeyDown(e,n),this._callHandlerIfNeeded(t,e,n,D.keydown),this.keyEventManager.simulatePendingKeyPressEvents(),this._simulator.handleKeyPressSimulation({event:e,key:n})))}},{key:"_howReactAppRespondedTo",value:function(e,t,n){var o=this.keyEventManager.reactAppHistoryWithEvent(t,n);switch(o){case vt:this.logger.logIgnoredKeyEvent(e,t,n,"React app has already handled it");break;case yt:this.logger.logIgnoredKeyEvent(e,t,n,"React app has declared it should be ignored");break;case dt:break;default:ft.incrementId()}return o}},{key:"handleKeyPress",value:function(e){var t,n=ut(e);this._isIgnoringRepeatedEvent(e,n,D.keypress)||(this.currentCombination.isKeyPressSimulated(n)?this.logger.logEventAlreadySimulated(e,n,D.keypress):(t=this._howReactAppRespondedTo(e,n,D.keypress),this.currentCombination.isKeyIncluded(n)&&this._recordNewKeyInCombination(n,D.keypress,He(e)),t===ht&&(this.keyEventManager.closeHangingKeyCombination(n,D.keypress),this.eventOptions.ignoreEventsCondition(e))?this.logger.logEventRejectedByFilter(e,n,D.keypress):this._callHandlerIfNeeded(t,e,n,D.keypress)))}},{key:"_callHandlerIfNeeded",value:function(e,t,n,o){wt([yt,vt],e)||this._callHandlerIfExists(t,n,o)}},{key:"handleKeyUp",value:function(e){var t,n=ut(e);this.currentCombination.isKeyUpSimulated(n)?this.logger.logEventAlreadySimulated(e,n,D.keyup):(t=this._howReactAppRespondedTo(e,n,D.keyup),this.currentCombination.isKeyIncluded(n)&&this._recordNewKeyInCombination(n,D.keyup,He(e)),t===ht?(this.keyEventManager.closeHangingKeyCombination(n,D.keyup),this.eventOptions.ignoreEventsCondition(e)?this.logger.logIgnoredKeyEvent(e,n,D.keyup,"ignoreEventsFilter rejected it"):this._callHandlerIfNeeded(t,e,n,D.keyup)):this._callHandlerIfNeeded(t,e,n,D.keyup),this._simulateKeyUpEventsHiddenByCmd(e,n),this._callKeyCombinationCallbackIfDefined())}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e){var n=this;ct(e)&&(this.keyEventManager.simulatePendingKeyUpEvents(),new Le(this.currentCombination).forEachKey(function(e){ct(e)||n._simulator.handleKeyUpSimulation({event:t,key:e})}))}},{key:"_callKeyCombinationCallbackIfDefined",value:function(){var e;this.listeners.get("keyCombination")&&this.currentCombination.hasEnded()&&(e=new Me(this.currentCombination),this.listeners.get("keyCombination")({keys:e.asKeyDictionary(),id:e.describe()}))}},{key:"_callHandlerIfExists",value:function(e,t,n){var o=tt(n),i=this._describeCurrentCombination();this.componentList.anyActionsForEventType(n)?this._callClosestMatchingHandler(e,t,n):this.logger.logIgnoredEvent("'".concat(i,"' ").concat(o),"it doesn't have any ".concat(o," handlers"))}},{key:"_callClosestMatchingHandler",value:function(e,t,n){for(var o=this.componentList.iterator;o.next();)if(this.actionResolver.callClosestMatchingHandler(e,t,n,o.position,0))return}},{key:"stopEventPropagation",value:function(e,t){e.simulated||e.stopPropagation()}},{key:"addKeyCombinationListener",value:function(t){function n(){e.listeners.remove("keyCombination")}var e=this;return this.listeners.set("keyCombination",function(e){t(e),n()}),this._updateDocumentHandlers(),n}}]),o}();function Lt(t,n,e){return e.forEach(function(e){U(t,e)&&(n[e]=t[e])}),n}var xt=["sequence","action"],Ft=["name","description","group"];function Dt(e){return S(e).map(function(e){return fe(e)?Lt(e,{},xt):{sequence:e}})}var Rt=(c(jt,[{key:"build",value:function(){return this._componentTree.hasRoot()?this._build([this._componentTree.rootId],{}):{}}},{key:"_build",value:function(e,i){var n=this;return e.forEach(function(e){var t=n._componentTree.get(e),e=t.childIds,o=t.keyMap;o&&Object.keys(o).forEach(function(e){var t,n;n=i,t=(t=o)[e=e],n[e]={},fe(t)?U(t,"sequences")?(Lt(t,n[e],Ft),n[e].sequences=Dt(t.sequences)):(Lt(t,n[e],Ft),n[e].sequences=[Lt(t,{},xt)]):n[e].sequences=Dt(t)}),n._build(e,i)}),i}}]),jt);function jt(e){u(this,jt),this._componentTree=e}var Nt=(c(qt,[{key:"applicationKeyMap",get:function(){return[this.globalEventStrategy,this.focusOnlyEventStrategy].reduce(function(e,t){t=new Rt(t.componentTree).build();return a(a({},e),t)},{})}},{key:"registerComponentMount",value:function(e,t){return this._incrementComponentCount(),this.focusOnlyEventStrategy.registerComponentMount(e,t)}},{key:"registerComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"_incrementComponentCount",value:function(){var e=this.mountedComponentsCount;this.mountedComponentsCount+=1,0===e&&1===this.mountedComponentsCount&&window.addEventListener("blur",this._blurHandler)}},{key:"_decrementComponentCount",value:function(){var e=this.mountedComponentsCount;--this.mountedComponentsCount,1===e&&0===this.mountedComponentsCount&&window.removeEventListener("blur",this._blurHandler)}},{key:"_clearKeyHistory",value:function(){this.focusOnlyEventStrategy.resetKeyHistory({force:!0}),this.globalEventStrategy.resetKeyHistory({force:!0})}},{key:"registerGlobalComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"registerGlobalComponentMount",value:function(e,t){return this._incrementComponentCount(),this.globalEventStrategy.registerComponentMount(e,t)}},{key:"addKeyCombinationListener",value:function(e){return this.globalEventStrategy.addKeyCombinationListener(e)}},{key:"ignoreEvent",value:function(e){this.focusOnlyEventStrategy.eventPropagator.ignoreEvent(e)}},{key:"observeIgnoredEvents",value:function(e){this.focusOnlyEventStrategy.eventPropagator.observeIgnoredEvents(e)}},{key:"closeHangingKeyCombination",value:function(e,t){this.focusOnlyEventStrategy.closeHangingKeyCombination(e,t)}},{key:"reactAppHistoryWithEvent",value:function(e,t){var n=this.focusOnlyEventStrategy.eventPropagator.previousPropagation;return n.isForKey(e)&&n.isForEventType(t)?n.isHandled()?vt:n.isIgnoringEvent()?yt:dt:ht}},{key:"simulatePendingKeyPressEvents",value:function(){this.focusOnlyEventStrategy.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this.focusOnlyEventStrategy.simulatePendingKeyUpEvents()}},{key:"isGlobalListenersBound",value:function(){return this.globalEventStrategy.isListenersBound()}}],[{key:"getInstance",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return we(this,"instance",function(){return new qt(e)})}},{key:"getFocusOnlyEventStrategy",value:function(){return this.getInstance().focusOnlyEventStrategy}},{key:"getGlobalEventStrategy",value:function(){return this.getInstance().globalEventStrategy}}]),qt);function qt(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,qt);var t=O.option("logLevel");this.logger=e.logger||new x(t),this.focusOnlyEventStrategy=new It({configuration:e,logLevel:t},this),this.globalEventStrategy=new At({configuration:e,logLevel:t},this),this.mountedComponentsCount=0,this._blurHandler=this._clearKeyHistory.bind(this)}function Bt(t,n){return"function"==typeof t?function(e){t(e),n(e)}:n}function Ut(){return{defaultKeyEvent:O.option("defaultKeyEvent")}}var zt=(c(Wt,[{key:"focusTreeId",get:function(){return this._focusTreeIds[0]}},{key:"getComponentProps",value:function(e){var t=this,n={onFocus:Bt(e.onFocus,function(){return t.enableHotKeys(e)}),onBlur:Bt(e.onBlur,function(){return t.disableHotKeys(e)}),tabIndex:O.option("defaultTabIndex")};return this._shouldBindKeyListeners(e)&&(n.onKeyDown=function(e){return t._delegateEventToManager(e,"handleKeyDown")},n.onKeyPress=function(e){return t._delegateEventToManager(e,"handleKeyPress")},n.onKeyUp=function(e){return t._delegateEventToManager(e,"handleKeyUp")}),n}},{key:"_shouldBindKeyListeners",value:function(e){return!Ie(this._getKeyMap(e))||e.root}},{key:"addHotKeys",value:function(e){Nt.getInstance().registerComponentMount(this.id,e)}},{key:"enableHotKeys",value:function(e){e.onFocus&&e.onFocus.apply(e,arguments);e=Nt.getFocusOnlyEventStrategy().enableHotKeys(this.id,this._getKeyMap(e),this._getHandlers(e),Ut());L(e)||this._focusTreeIdsPush(e),this._setFocused(!0)}},{key:"updateHotKeys",value:function(e){var t,n=Nt.getFocusOnlyEventStrategy();n.reregisterKeyMap(this.id,e.keyMap),!this._componentIsFocused()||!e.allowChanges&&O.option("ignoreKeymapAndHandlerChangesByDefault")||(t=e.keyMap,e=e.handlers,n.updateEnabledHotKeys(this.focusTreeId,this.id,t,e,Ut()))}},{key:"disableHotKeys",value:function(e){e.onBlur&&e.onBlur.apply(e,arguments),Nt.getFocusOnlyEventStrategy().disableHotKeys(this.focusTreeId,this.id)||this._focusTreeIdsShift(),this._setFocused(!1)}},{key:"removeKeyMap",value:function(e){Nt.getFocusOnlyEventStrategy().deregisterKeyMap(this.id),Nt.getInstance().registerComponentUnmount(),this.disableHotKeys(e)}},{key:"_componentIsFocused",value:function(){return!0===this._focused}},{key:"_focusTreeIdsPush",value:function(e){this._focusTreeIds.push(e)}},{key:"_focusTreeIdsShift",value:function(){this._focusTreeIds.shift()}},{key:"_setFocused",value:function(e){this._focused=e}},{key:"_delegateEventToManager",value:function(e,t){Nt.getFocusOnlyEventStrategy()[t](e,this.focusTreeId,this.id,{ignoreEventsCondition:O.option("ignoreEventsCondition")})&&this._focusTreeIdsShift()}},{key:"_mergeWithOptions",value:function(e,t){return a(a({},this._hotKeysOptions[e]||{}),t[e]||{})}},{key:"_getHandlers",value:function(e){return this._mergeWithOptions("handlers",e)}},{key:"_getKeyMap",value:function(e){return this._mergeWithOptions("keyMap",e)}}]),Wt);function Wt(e,t){t=t.keyMap;u(this,Wt),this._hotKeysOptions=e,this.id=Nt.getFocusOnlyEventStrategy().registerKeyMap(t),this.childContext={hotKeysParentId:this.id},this._focusTreeIds=[]}var Gt=["keyMap","handlers","allowChanges","root"],Jt={keyMap:t.object,handlers:t.object,onFocus:t.func,onBlur:t.func,allowChanges:t.bool,root:t.bool};function $t(e){return A(function(t,e){var n,i=1<arguments.length&&void 0!==e?e:{},e=n=function(){y(o,r.PureComponent);var n=_(o);function o(e){var t;return u(this,o),(t=n.call(this,e))._manager=new zt(i,e),t}return c(o,[{key:"componentDidMount",value:function(){this._manager.addHotKeys(this.context.hotKeysParentId)}},{key:"componentDidUpdate",value:function(){this._manager.updateHotKeys(this.props)}},{key:"componentWillUnmount",value:function(){this._manager.removeKeyMap(this.props)}},{key:"render",value:function(){var e=this.props,e=(e.keyMap,e.handlers,e.allowChanges,e.root,m(e,Gt));return s.createElement(t,h({hotKeys:this._manager.getComponentProps(this.props)},e))}}]),o}();return l(n,"propTypes",Jt),e}(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}),{deprecatedAPI:{contextTypes:{hotKeysParentId:t.number},childContextTypes:{hotKeysParentId:t.number}},newAPI:{contextType:{hotKeysParentId:void 0}}})}var Vt=["hotKeys","innerRef","component"],Yt=$t(function(){y(t,r.Component);var e=_(t);function t(){return u(this,t),e.apply(this,arguments)}return c(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=e.innerRef,o=e.component,e=m(e,Vt),o=o||O.option("defaultComponent");return s.createElement(o,a(a({},t),{},{ref:n},e))}}]),t}());Yt.propTypes={innerRef:t.oneOfType([t.object,t.func])};var Qt=(c(Xt,[{key:"addHotKeys",value:function(e,t){var n=e.keyMap,e=e.handlers,t=t.globalHotKeysParentId;Nt.getInstance().registerGlobalComponentMount(this.id,t),Nt.getGlobalEventStrategy().enableHotKeys(this.id,n,e,Xt._getComponentOptions(),Xt._getEventOptions())}},{key:"updateHotKeys",value:function(e){var t,n=Nt.getGlobalEventStrategy();n.reregisterKeyMap(this.id,e.keyMap),!e.allowChanges&&O.option("ignoreKeymapAndHandlerChangesByDefault")||(t=e.keyMap,e=e.handlers,n.updateEnabledHotKeys(this.id,t,e,Xt._getComponentOptions(),Xt._getEventOptions()))}},{key:"removeKeyMap",value:function(){var e=Nt.getGlobalEventStrategy();e.deregisterKeyMap(this.id),e.disableHotKeys(this.id),Nt.getInstance().registerGlobalComponentUnmount()}}],[{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:O.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:O.option("ignoreEventsCondition")}}}]),Xt);function Xt(e){u(this,Xt),this.id=Nt.getGlobalEventStrategy().registerKeyMap(e),this.childContext={globalHotKeysParentId:this.id}}var Zt=function(){y(o,r.Component);var n=_(o);function o(e){var t;return u(this,o),(t=n.call(this,e))._manager=new Qt(e.keyMap),t}return c(o,[{key:"render",value:function(){return this.props.children||null}},{key:"componentDidMount",value:function(){this._manager.addHotKeys(this.props,this.context)}},{key:"componentDidUpdate",value:function(){this._manager.updateHotKeys(this.props)}},{key:"componentWillUnmount",value:function(){this._manager.removeKeyMap()}}]),o}();l(Zt,"propTypes",{keyMap:t.object,handlers:t.object,allowChanges:t.bool});var en=A(Zt,{deprecatedAPI:{contextTypes:{globalHotKeysParentId:t.number},childContextTypes:{globalHotKeysParentId:t.number}},newAPI:{contextType:{globalHotKeysParentId:void 0}}}),tn=(c(nn,[{key:"getComponentProps",value:function(e){var t=this;return{onKeyDown:this._handleKeyEvent,onKeyPress:this._handleKeyEvent,onKeyUp:this._handleKeyEvent,onFocus:function(){return t._reloadDictionaries(e())}}}},{key:"_reloadDictionaries",value:function(e){var t=e.only,e=e.except;this._onlyDict=on(t),this._exceptDict=on(e)}},{key:"_handleKeyEvent",value:function(e){this._shouldIgnoreEvent(e)&&Nt.getInstance()[this._eventManagerMethod](e)}},{key:"_shouldIgnoreEvent",value:function(e){e=e.key;return Ie(this._onlyDict)?!!Ie(this._exceptDict)||!U(this._exceptDict,e):Ie(this._exceptDict)?U(this._onlyDict,e):U(this._onlyDict,e)&&!U(this._exceptDict,e)}}]),nn);function nn(e){u(this,nn),this._handleKeyEvent=this._handleKeyEvent.bind(this),this._eventManagerMethod=e}function on(e){return S(e).reduce(function(e,t){var n=ee(t);if(!ie(n))throw new re(t);return w([ve,Z,B,G,de,ye],!0,function(e){return e(n)},e),e},{})}var rn=["only","except"],sn={only:t.oneOfType([t.string,t.arrayOf(t.string)]),except:t.oneOfType([t.string,t.arrayOf(t.string)])};function an(o,e,t){var n=1<arguments.length&&void 0!==e?e:{only:[],except:[]},i=2<arguments.length?t:void 0,t=e=function(){y(n,r.PureComponent);var t=_(n);function n(e){return u(this,n),(e=t.call(this,e))._manager=new tn(i),e}return c(n,[{key:"render",value:function(){var e=this,t=this.props,t=(t.only,t.except,m(t,rn));return s.createElement(o,h({hotKeys:this._manager.getComponentProps(function(){return e.props})},t))}}]),n}();return l(e,"propTypes",sn),l(e,"defaultProps",n),t}var un=["hotKeys"];function cn(e){var t,n=t=function(){y(t,r.Component);var e=_(t);function t(){return u(this,t),e.apply(this,arguments)}return c(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=m(e,un),e=n.component||O.option("defaultComponent");return s.createElement(e,a(a({},t),n))}}]),t}();return l(t,"displayName",e),n}var ln=an(cn("IgnoreKeys"),{},"ignoreEvent"),Zt=an(cn("ObserveKeys"),{},"observeIgnoredEvents");e.GlobalHotKeys=en,e.HotKeys=Yt,e.IgnoreKeys=ln,e.KeyEventManager=Nt,e.ObserveKeys=Zt,e.configure=function(){O.init(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},e.getApplicationKeyMap=function(){return Nt.getInstance().applicationKeyMap},e.recordKeyCombination=function(e){return Nt.getInstance().addKeyCombinationListener(e)},e.withHotKeys=$t,e.withIgnoreKeys=function(e){return an(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"ignoreEvent")},e.withObserveKeys=function(e){return an(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"observeIgnoredEvents")},Object.defineProperty(e,"__esModule",{value:!0})});
