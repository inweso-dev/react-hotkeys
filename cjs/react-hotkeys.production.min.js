/**
 * ISC License
 *
 * Copyright (c) 2018, Aleck Greenham
 *
 * Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var PropTypes=_interopDefault(require("prop-types")),React=require("react"),React__default=_interopDefault(React);function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);o=new(Function.bind.apply(e,o));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var n,o={},i=Object.keys(e),r=0;r<i.length;r++)n=i[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _objectWithoutProperties(e,t){if(null==e)return{};var n,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),r=0;r<i.length;r++)n=i[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(n){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=_superPropBase(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,i=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw i}}}}function arrayFrom(e){return Array.isArray(e)?e:e?[e]:[]}function nop(e){return e}function dictionaryFrom(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:nop,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i="function"==typeof t?t:function(){return t};return arrayFrom(e).reduce(function(e,t){return e[n(t)]=i(t),e},o)}var objectValues=function(t){return Object.keys(t).map(function(e){return t[e]})},_defaultConfiguration={logLevel:"warn",defaultKeyEvent:"keydown",defaultComponent:"div",defaultTabIndex:"-1",ignoreTags:["input","select","textarea"],ignoreKeymapAndHandlerChangesByDefault:!0,ignoreEventsCondition:function(e){var t=e.target;if(t&&t.tagName){e=t.tagName.toLowerCase();return Configuration.option("_ignoreTagsDict")[e]||t.isContentEditable}return!1},ignoreRepeatedEventsWhenKeyHeldDown:!0,simulateMissingKeyPressEvents:!0,stopEventPropagationAfterHandling:!0,stopEventPropagationAfterIgnoring:!0,allowCombinationSubmatches:!1,customKeyCodes:{}},_configuration=_objectSpread2({},_defaultConfiguration);_configuration._ignoreTagsDict=dictionaryFrom(_configuration.ignoreTags);var Configuration=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"init",value:function(t){var n=this,e=t.ignoreTags,o=t.customKeyCodes;e&&(t._ignoreTagsDict=dictionaryFrom(t.ignoreTags)),o&&(t._customKeyNamesDict=dictionaryFrom(objectValues(t.customKeyCodes))),-1!==["verbose","debug","info"].indexOf(t.logLevel)&&console.warn("React HotKeys: You have requested log level '".concat(t.logLevel,"' but for performance reasons, logging below severity level 'warning' is disabled in production. Please use the development build for complete logs.")),Object.keys(t).forEach(function(e){n.set(e,t[e])})}},{key:"set",value:function(e,t){_configuration[e]=t}},{key:"reset",value:function(e){_configuration[e]=_defaultConfiguration[e]}},{key:"option",value:function(e){return _configuration[e]}}]),e}();function backwardsCompatibleContext(e,t){var n,o=t.deprecatedAPI,i=o.contextTypes,o=o.childContextTypes,t=t.newAPI.contextType;return void 0===React__default.createContext?(e.contextTypes=i,e.childContextTypes=o,e.prototype.getChildContext=function(){return this._manager.childContext}):(n=React__default.createContext(t),e.contextType=n,e.prototype._originalRender=e.prototype.render,e.prototype.render=function(){var e=this._originalRender();return e?React__default.createElement(n.Provider,{value:this._manager.childContext},e):null}),e}function isUndefined(e){return void 0===e}var Logger=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"warn";_classCallCheck(this,i),_defineProperty(this,"verbose",this.noop),_defineProperty(this,"debug",this.noop),_defineProperty(this,"info",this.noop),_defineProperty(this,"warn",this.noop),_defineProperty(this,"error",this.noop),this.logLevel=this.constructor.levels[e];for(var t=0,n=["error","warn","info","debug","verbose"];t<n.length;t++){var o=n[t];if(this.logLevel<this.constructor.levels[o])return;this[o]=-1===["debug","verbose"].indexOf(o)?console[o]:console.log}}return _createClass(i,[{key:"noop",value:function(){}}]),i}();_defineProperty(Logger,"logIcons",["ðŸ“•","ðŸ“—","ðŸ“˜","ðŸ“™"]),_defineProperty(Logger,"componentIcons",["ðŸ”º","â­ï¸","ðŸ”·","ðŸ”¶","â¬›ï¸"]),_defineProperty(Logger,"eventIcons",["â¤ï¸","ðŸ’š","ðŸ’™","ðŸ’›","ðŸ’œ","ðŸ§¡"]),_defineProperty(Logger,"levels",{none:0,error:1,warn:2,info:3,debug:4,verbose:5});var KeyEventType={keydown:0,keypress:1,keyup:2},KeyEventSequenceIndex={previous:0,current:1},ShiftedKeysDictionary={"`":["~"],1:["!"],2:["@",'"'],3:["#","Â£"],4:["$"],5:["%"],6:["^"],7:["&"],8:["*"],9:["("],0:[")"],"-":["_"],"=":["plus"],";":[":"],"'":['"',"@"],",":["<"],".":[">"],"/":["?"],"\\":["|"],"[":["{"],"]":["}"],"#":["~"]};function fallbackToTransformedSelf(e,t,n){return e[t]||[1===t.length?t[n]():t]}function resolveShiftedAlias(e){return fallbackToTransformedSelf(ShiftedKeysDictionary,e,"toUpperCase")}function hasKey(e,t){return e.hasOwnProperty(t)}function invertArrayDictionary(o){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(o).reduce(function(t,n){var e=o[n];return e.forEach(function(e){hasKey(t,e)||(t[e]=[]),t[e].push(n)}),i.includeOriginal&&(hasKey(t,n)||(t[n]=[]),t[n]=[].concat(_toConsumableArray(t[n]),_toConsumableArray(e))),t},{})}var UnshiftedKeysDictionary=invertArrayDictionary(ShiftedKeysDictionary);function resolveUnshiftedAlias(e){return fallbackToTransformedSelf(UnshiftedKeysDictionary,e,"toLowerCase")}var KeyOSAndLayoutAliasesDictionary={},KeyOSAndLayoutAliasesDictionary$1=invertArrayDictionary(KeyOSAndLayoutAliasesDictionary,{includeOriginal:!0});function isString(e){return"string"==typeof e}function stripSuperfluousWhitespace(e){return isString(e)?e.trim().replace(/\s+/g," "):e}var MousetrapToReactKeyNamesDictionary={tab:"Tab",capslock:"CapsLock",shift:"Shift",meta:"Meta",alt:"Alt",ctrl:"Control",space:" ",spacebar:" ",escape:"Escape",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",return:"Enter",del:"Delete",command:"Meta",option:"Alt",enter:"Enter",backspace:"Backspace",ins:"Insert",pageup:"PageUp",pagedown:"PageDown",end:"End",home:"Home",contextmenu:"ContextMenu",numlock:"Clear"},KeyShorthandDictionary={cmd:"Meta"},AltShiftedKeysDictionary={"`":["`"],1:["â„"],2:["â‚¬"],3:["â€¹"],4:["â€º"],5:["ï¬"],6:["ï¬‚"],7:["â€¡"],8:["Â°"],9:["Â·"],0:["â€š"],"-":["â€”"],"=":["Â±"],a:["Ã…"],b:["Ä±"],c:["Ã‡"],d:["ÃŽ"],e:["Â´"],f:["Ã"],g:["Ë"],h:["Ã“"],i:["Ë†"],j:["Ã”"],k:["ï£¿"],l:["Ã’"],m:["Ã‚"],n:["Ëœ"],o:["Ã˜"],p:["Ï€"],q:["Å’"],r:["â€°"],s:["Ã"],t:["ÃŽ"],u:["Â¨"],v:["â—Š"],w:["â€ž"],x:["Ë›"],y:["Ã"],z:["Â¸"],"[":["â€"],"]":["â€™"],"\\":["Â»"],"'":["Ã†"],";":["Ãš"],",":["Â¯"],".":["Ë˜"]},UnaltShiftedKeysDictionary=invertArrayDictionary(AltShiftedKeysDictionary);function resolveUnaltShiftedAlias(e){return UnaltShiftedKeysDictionary[e]||resolveUnshiftedAlias(e)}function standardizeKeyName(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shift:!1,alt:!1},n=e.toLowerCase(),e=MousetrapToReactKeyNamesDictionary[n]||KeyShorthandDictionary[n]||(e.match(/^f\d+$/)?e.toUpperCase():e);return t.shift?(t.alt?resolveUnaltShiftedAlias:resolveUnshiftedAlias)(e):e}var translateToKey={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NonPrintableKeysDictionary=dictionaryFrom(objectValues(translateToKey));function isNonPrintableKeyName(e){return!!NonPrintableKeysDictionary[e]}function isCustomKeyName(e){return Configuration.option("_customKeyNamesDict")[e]}function isValidKey(e){return isNonPrintableKeyName(e)||String.fromCharCode(e.charCodeAt(0))===e||isCustomKeyName(e)}var InvalidKeyNameError=function(){_inherits(r,_wrapNativeSuper(Error));var i=_createSuper(r);function r(){var e;_classCallCheck(this,r);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return _defineProperty(_assertThisInitialized(e=i.call.apply(i,[this].concat(n))),"name","InvalidKeyNameError"),e}return r}();function normalizedCombinationId(e){return Object.keys(e).sort(function(e,t){return e.length!==t.length?t.length-e.length:e<t?-1:t<e?1:0}).join("+")}var KeySequenceParser=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=stripSuperfluousWhitespace(e).split(" ");try{var n=e.slice(0,e.length-1),o=e[e.length-1],i=n.map(function(e){return normalizedCombinationId(parseCombination(e,t))}).join(" "),r=parseCombination(o,t),s={id:normalizedCombinationId(r),keyDictionary:r,keyEventType:t.keyEventType,size:Object.keys(r).length};return{sequence:{prefix:i,size:n.length+1},combination:s}}catch(e){return{sequence:null,combination:null}}}}]),e}();function parseCombination(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=-1!==e.indexOf(/[sS]hift/),i=-1!==e.indexOf(/[sS]hift/);return e.replace(/^\+|(\s|[^+]\+)\+/,"$1plus").split("+").reduce(function(e,t){t=standardizeKeyName(t,{shift:o,alt:i});if(n.ensureValidKeys&&!isValidKey(t))throw new InvalidKeyNameError;return e[t]=!0,e},{})}var AltedKeysDictionary={"`":["`"],1:["Â¡"],2:["â„¢"],3:["Â£"],4:["Â¢"],5:["âˆž"],6:["Â§"],7:["Â¶"],8:["â€¢"],9:["Âª"],0:["Âº"],"-":["â€“"],"=":["â‰ "],a:["Ã¥"],b:["âˆ«"],c:["Ã§"],d:["âˆ‚"],e:["Â´"],f:["Æ’"],g:["Â©"],h:["Ë™"],i:["Ë†"],j:["âˆ†"],k:["Ëš"],l:["Â¬"],m:["Âµ"],n:["Ëœ"],o:["Ã¸"],p:["Ï€"],q:["Å“"],r:["Â®"],s:["ÃŸ"],t:["â€ "],u:["Â¨"],v:["âˆš"],w:["âˆ‘"],x:["â‰ˆ"],y:["Â¥"],z:["Î©"],"[":["â€œ"],"]":["â€˜"],"\\":["Â«"],"'":["Ã¦"],";":["â€¦"],",":["â‰¤"],".":["â‰¥"],"/":["Ã·"]},UnaltedKeysDictionary=invertArrayDictionary(AltedKeysDictionary);function resolveUnaltedAlias(e){return UnaltedKeysDictionary[e]||[e]}function resolveAltedAlias(e){return AltedKeysDictionary[e]||[e]}function resolveAltShiftedAlias(e){return AltShiftedKeysDictionary[e]||[e]}function isObject(e){return!Array.isArray(e)&&"object"===_typeof(e)&&null!==e}function size(e){return(isObject(e)?Object.keys(e):e).length}function distinct(e){return Object.keys(dictionaryFrom(e))}function buildShiftedKeyAliases(e,t){return e?[].concat(_toConsumableArray(resolveAltShiftedAlias(t)),_toConsumableArray(resolveUnaltShiftedAlias(t)),[t]):[].concat(_toConsumableArray(resolveShiftedAlias(t)),_toConsumableArray(resolveUnshiftedAlias(t)),[t])}function buildAltKeyAliases(e){return[].concat(_toConsumableArray(resolveAltedAlias(e)),_toConsumableArray(resolveUnaltedAlias(e)),[e])}function buildOSAndKeyboardLayoutAliases(e){var t=KeyOSAndLayoutAliasesDictionary$1[e];return t?[e].concat(_toConsumableArray(t)):[e]}function buildKeyAliasList(e,t){var n=e.Shift,e=e.Alt;return distinct(n?buildShiftedKeyAliases(e,t):(e?buildAltKeyAliases:buildOSAndKeyboardLayoutAliases)(t))}function buildKeyCombinationPermutations(t){return Object.keys(t).reduce(function(n,e){e=buildKeyAliasList(t,e);return 0===size(n)?e.map(function(e){return _defineProperty({},e,!0)}):e.reduce(function(e,t){return e.concat(n.map(function(e){return _objectSpread2(_objectSpread2({},e),{},_defineProperty({},t,!0))}))},[])},[])}var KeyCombinationSerializer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return buildKeyCombinationPermutations(e).map(normalizedCombinationId)}},{key:"isValidKeySerialization",value:function(e){return 0<e.length&&!!KeySequenceParser.parse(e,{ensureValidKeys:!0}).combination}}]),e}();function resolveKeyAlias(e){return KeyOSAndLayoutAliasesDictionary$1[e]||[e]}function applicableAliasFunctions(e){return e.Shift?e.Alt?[resolveAltShiftedAlias,resolveUnaltShiftedAlias]:[resolveShiftedAlias,resolveUnshiftedAlias]:e.Alt?[resolveAltedAlias,resolveUnaltedAlias]:[nop$1,nop$1]}function nop$1(e){return[e]}var KeyEventState={unseen:0,seen:1,simulated:2},KeyEventStateArrayManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"newRecord",value:function(e,t){var n=[KeyEventState.unseen,KeyEventState.unseen,KeyEventState.unseen];if(!isUndefined(e))for(var o=0;o<=e;o++)n[o]=t;return n}},{key:"setBit",value:function(e,t,n){return e[t]=n,e}},{key:"clone",value:function(e){for(var t=this.newRecord(),n=0;n<e.length;n++)t[n]=e[n];return t}}]),e}();function isEmpty(e){return isObject(e)?0===Object.keys(e).length:!e||0===e.length}function lazyLoadAttribute(e,t,n){return e[t]||(e[t]="function"==typeof n?n():n),e[t]}var ModifierFlagsDictionary={Shift:["shiftKey"],Meta:["metaKey"],Control:["ctrlKey"],Alt:["altKey"]};function stateFromEvent(e){return e.simulated?KeyEventState.simulated:KeyEventState.seen}var KeyCombination=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.keyStates=e,this.isEnding=!1,this._keyAliases=void 0,this._ids=void 0}return _createClass(t,[{key:"ids",get:function(){var e=this;return lazyLoadAttribute(this,"_ids",function(){return KeyCombinationSerializer.serialize(e.keyStates)})}},{key:"keyAliases",get:function(){var e=this;return lazyLoadAttribute(this,"_keyAliases",function(){return buildKeyAliases(e.keyStates)})}},{key:"getNormalizedKeyName",value:function(e){if(this.keyStates[e])return e;var t=this.keyAliases[e];return t||e}},{key:"hasEnded",value:function(){return isEmpty(this.keysStillPressedDict())}},{key:"addKey",value:function(e,t){this._setKeyState(e,[KeyEventStateArrayManager.newRecord(),KeyEventStateArrayManager.newRecord(KeyEventType.keydown,t)])}},{key:"setKeyState",value:function(e,t,n){var o,i=this._getKeyState(e);this.isKeyIncluded(e)?(o=KeyEventStateArrayManager.clone(i[1]),i=KeyEventStateArrayManager.clone(o),KeyEventStateArrayManager.setBit(i,t,n),this._setKeyState(e,[o,i])):this.addKey(e,n),t===KeyEventType.keyup&&(this.isEnding=!0)}},{key:"keysStillPressedDict",value:function(){var n=this;return this.keys.reduce(function(e,t){return n.isKeyStillPressed(t)&&(e[t]=n._getKeyState(t)),e},{})}},{key:"isKeyIncluded",value:function(e){return!!this._getKeyState(e)}},{key:"isKeyStillPressed",value:function(e){return this.isEventTriggered(e,KeyEventType.keypress)&&!this.isKeyReleased(e)}},{key:"isKeyReleased",value:function(e){return this.isEventTriggered(e,KeyEventType.keyup)}},{key:"isEventTriggered",value:function(e,t){return this._getKeyStateType(e,KeyEventSequenceIndex.current,t)}},{key:"wasEventPreviouslyTriggered",value:function(e,t){return this._getKeyStateType(e,KeyEventSequenceIndex.previous,t)}},{key:"isKeyPressSimulated",value:function(e){return this.isEventTriggered(e,KeyEventType.keypress)===KeyEventState.simulated}},{key:"isKeyUpSimulated",value:function(e){return this.isEventTriggered(e,KeyEventType.keyup)===KeyEventState.simulated}},{key:"resolveModifierFlagDiscrepancies",value:function(o,e,i){var r=this;Object.keys(ModifierFlagsDictionary).forEach(function(t){var n;e===t&&i===KeyEventType.keyup||(n=r.isKeyStillPressed(t),ModifierFlagsDictionary[t].forEach(function(e){!1===o[e]&&n&&r.setKeyState(t,KeyEventType.keyup,stateFromEvent(o))}))})}},{key:"keys",get:function(){return Object.keys(this.keyStates)}},{key:"_getKeyStateType",value:function(e,t,n){e=this._getKeyState(e);return e&&e[t][n]}},{key:"_getKeyState",value:function(e){var t=this.keyStates[e];if(t)return t;e=this.keyAliases[e];return e?this.keyStates[e]:void 0}},{key:"_setKeyState",value:function(e,t){e=this.getNormalizedKeyName(e);this.keyStates[e]=t,delete this._keyAliases,delete this._ids}}]),t}();function buildKeyAliases(e){return Object.keys(e).reduce(function(n,o){return resolveKeyAlias(o).forEach(function(t){applicableAliasFunctions(e).forEach(function(e){e(t).forEach(function(e){e===o&&o===t||(n[e]=o)})})}),n},{})}var KeyCombinationDecorator=function(){function t(e){_classCallCheck(this,t),this._keyCombination=e}return _createClass(t,[{key:"describe",value:function(){return this._keyCombination.ids[0]}},{key:"asKeyDictionary",value:function(){return dictionaryFrom(this._keyCombination.keys)}},{key:"toJSON",value:function(){return{keys:this._keyCombination.keyStates,ids:this._keyCombination.ids,keyAliases:this._keyCombination.keyAliases}}}]),t}(),KeyCombinationIterator=function(){function t(e){_classCallCheck(this,t),this._keyCombination=e}return _createClass(t,[{key:"any",value:function(){return 0<this._getKeys().length}},{key:"numberOfKeys",get:function(){return size(this._getKeys())}},{key:"forEachKey",value:function(e){return this._getKeys().forEach(e)}},{key:"some",value:function(e){return this._getKeys().some(e)}},{key:"_getKeys",value:function(){return this._keyCombination.keys}}]),t}(),KeyHistory=function(){function n(e){var t=e.maxLength,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,n),this._combinations=[],this._maxLength=t,e?this._push(e):this._push(new KeyCombination)}return _createClass(n,[{key:"getPreviousCombinations",value:function(e){return this._combinations.slice(-(e+1),-1)}},{key:"any",value:function(){return this._combinations.some(function(e){return new KeyCombinationIterator(e).any()})}},{key:"length",get:function(){return this._combinations.length}},{key:"currentCombination",get:function(){return this._combinations[this.length-1]}},{key:"addKeyToCurrentCombination",value:function(e,t,n){this._ensureInitialKeyCombination(),this.currentCombination.setKeyState(e,t,n)}},{key:"maxLength",set:function(e){this._maxLength=e,this._trimHistory()}},{key:"startNewKeyCombination",value:function(e,t){this._ensureInitialKeyCombination();var n=new KeyCombination(this.currentCombination.keysStillPressedDict());n.addKey(e,t),this._push(n)}},{key:"toJSON",value:function(){return this._combinations.map(function(e){return new KeyCombinationDecorator(e).toJSON()})}},{key:"_ensureInitialKeyCombination",value:function(){0===this.length&&this._push(new KeyCombination)}},{key:"_push",value:function(e){this._trimHistory(),this._combinations.push(e)}},{key:"_trimHistory",value:function(){for(;this.length>this._maxLength;)this._shift()}},{key:"_shift",value:function(){this._combinations.shift()}}]),n}(),Registry=function(){function e(){_classCallCheck(this,e),this._registry={}}return _createClass(e,[{key:"get",value:function(e){return this._registry[e]}},{key:"set",value:function(e,t){this._registry[e]=t}},{key:"remove",value:function(e){delete this._registry[e]}},{key:"toJSON",value:function(){return this._registry}}]),e}();function without(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=dictionaryFrom(arrayFrom(e),function(e){return{value:e}});return Array.isArray(n)?n.reduce(function(e,t){return i[t]&&(o.stringifyFirst||i[t].value===t)||e.push(t),e},[]):isObject(n)?Object.keys(n).reduce(function(e,t){return i[t]||(e[t]=n[t]),e},{}):n}var ComponentTree=function(){_inherits(o,Registry);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.call(this)).clearRootId(),e}return _createClass(o,[{key:"hasRoot",value:function(){return!this.isRootId(null)}},{key:"isRootId",value:function(e){return e===this.rootId}},{key:"clearRootId",value:function(){this.rootId=null}},{key:"add",value:function(e,t){_get(_getPrototypeOf(o.prototype),"set",this).call(this,e,{childIds:[],parentId:null,keyMap:t})}},{key:"update",value:function(e,t){var n=_get(_getPrototypeOf(o.prototype),"get",this).call(this,e);_get(_getPrototypeOf(o.prototype),"set",this).call(this,e,_objectSpread2(_objectSpread2({},n),{},{keyMap:t}))}},{key:"setParent",value:function(e,t){isUndefined(t)?this.rootId=e:(this.get(e).parentId=t,this._addChildId(t,e))}},{key:"remove",value:function(e){var t=this._getParentId(e);this._removeChildId(t,e),_get(_getPrototypeOf(o.prototype),"remove",this).call(this,e)}},{key:"_getParentId",value:function(e){e=this.get(e);return e&&e.parentId}},{key:"_addChildId",value:function(e,t){this.get(e).childIds.push(t)}},{key:"_removeChildId",value:function(e,t){e=this.get(e);e&&(e.childIds=without(e.childIds,t))}}]),o}();function removeAtIndex(e,t){return[].concat(_toConsumableArray(e.slice(0,t)),_toConsumableArray(e.slice(t+1)))}var ComponentOptionsListIterator=function(){function t(e){_classCallCheck(this,t),this._list=e,this.position=-1}return _createClass(t,[{key:"getComponent",value:function(){return this._list.getAtPosition(this.position)}},{key:"next",value:function(){return this.position+1<this._list.length?(this.position++,this.getComponent()):null}}]),t}(),ComponentOptionsList=function(){function e(){_classCallCheck(this,e),this._list=[],this._idToIndex={},this.longestSequence=1,this._longestSequenceComponentId=null,this._keyMapEventRecord=KeyEventStateArrayManager.newRecord()}return _createClass(e,[{key:"iterator",get:function(){return new ComponentOptionsListIterator(this)}},{key:"add",value:function(e,t,n,o){if(this.containsId(e))return this.update(e,t,n,o);o=this._build(e,t,n,o);this._list.push(o);o=this.length-1;return this._idToIndex[e]=o}},{key:"containsId",value:function(e){return!!this.getById(e)}},{key:"getById",value:function(e){return this.getAtPosition(this.getPositionById(e))}},{key:"getPositionById",value:function(e){return this._idToIndex[e]}},{key:"update",value:function(e,t,n,o){var i=this._isUpdatingComponentWithLongestSequence(e),r=this.longestSequence,o=this._build(e,t,n,o);i&&o.sequenceLength!==r&&(o.sequenceLength>r?this.longestSequence=o.sequenceLength:this._recalculateLongestSequence()),this._list[this.getPositionById(e)]=o}},{key:"remove",value:function(e){var t=this._isUpdatingComponentWithLongestSequence(e);this.removeAtPosition(this.getPositionById(e)),t&&this._recalculateLongestSequence()}},{key:"isRoot",value:function(e){return this.getPositionById(e)>=this.length-1}},{key:"anyActionsForEventType",value:function(e){return!!this._keyMapEventRecord[e]}},{key:"length",get:function(){return this._list.length}},{key:"getAtPosition",value:function(e){return this._list[e]}},{key:"removeAtPosition",value:function(e){this._list=removeAtIndex(this._list,e);for(var t=e;t<this.length;)this._idToIndex[this.getAtPosition(t).componentId]=t,t++}},{key:"toJSON",value:function(){return this._list}},{key:"_build",value:function(e,t,n,o){return{actions:this._buildActionDictionary(t,o,e),handlers:n,componentId:e,options:o}}},{key:"_isUpdatingComponentWithLongestSequence",value:function(e){return e===this._getLongestSequenceComponentId()}},{key:"_getLongestSequenceComponentId",value:function(){return this._longestSequenceComponentId}},{key:"_recalculateLongestSequence",value:function(){for(var e=this.iterator;e.next();){var t=e.getComponent(),n=t.longestSequence,t=t.componentId;n>this.longestSequence&&(this._longestSequenceComponentId=t,this.longestSequence=n)}}},{key:"_buildActionDictionary",value:function(t,i,r){var s=this;return Object.keys(t).reduce(function(n,o){var e=t[o];return(isObject(e)&&hasKey(e,"sequences")?arrayFrom(e.sequences):arrayFrom(e)).forEach(function(e){var t=normalizeActionOptions(e,i),e=t.keySequence,t=t.keyEventType;s._addActionOptions(n,r,o,e,t)}),n},{})}},{key:"_addActionOptions",value:function(e,t,n,o,i){var r=KeySequenceParser.parse(o,{keyEventType:i}),o=r.sequence,r=r.combination;o.size>this.longestSequence&&(this.longestSequence=o.size,this._longestSequenceComponentId=t),this._keyMapEventRecord[i]=KeyEventState.seen,e[n]||(e[n]=[]),e[n].push(_objectSpread2({prefix:o.prefix,actionName:n,sequenceLength:o.size},r))}}]),e}();function normalizeActionOptions(e,t){if(isObject(e)){var n=e.sequence,o=e.action;return{keySequence:n,keyEventType:isUndefined(o)?KeyEventType[t.defaultKeyEvent]:KeyEventType[o]}}return{keySequence:e,keyEventType:KeyEventType[t.defaultKeyEvent]}}function indexFromEnd(e,t){return e[e.length-(t+1)]}for(var KeysWithKeyUpHiddenByCmd={Enter:!0,Backspace:!0,ArrowRight:!0,ArrowLeft:!0,ArrowUp:!0,ArrowDown:!0,CapsLock:!0},i=1;i<13;i++)KeysWithKeyUpHiddenByCmd["F".concat(i)]=!0;function keyupIsHiddenByCmd(e){return 1===e.length||hasKey(KeysWithKeyUpHiddenByCmd,e)}var KeyCombinationMatcher=function(){function e(){_classCallCheck(this,e),this._actionConfigs={},this._order=null}return _createClass(e,[{key:"addMatch",value:function(e,t){var n,o,i;this._includesMatcherForCombination(e.id)?(n=e.keyEventType,o=e.actionName,i=e.id,this._addHandlerToActionConfig(i,{keyEventType:n,actionName:o,handler:t})):this._addNewActionConfig(e,t)}},{key:"findMatch",value:function(e,t,n){var o=this;lazyLoadAttribute(this,"order",function(){return o._setOrder()});var i,r=_createForOfIteratorHelper(this._order);try{for(r.s();!(i=r.n()).done;){var s=i.value,a=this._actionConfigs[s];if(this._matchesActionConfig(e,t,n,a))return a}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"toJSON",value:function(){return{actionConfigs:this._actionConfigs,order:this._order}}},{key:"_matchesActionConfig",value:function(t,n,o,e){if(!canBeMatched(t,e)||!e.events[o])return!1;var i=!1;return Object.keys(e.keyDictionary).every(function(e){return!!t.isEventTriggered(e,o)&&(n&&n===t.getNormalizedKeyName(e)&&(i=!t.wasEventPreviouslyTriggered(e,o)),!0)})&&i}},{key:"_setOrder",value:function(){var n=objectValues(this._actionConfigs).reduce(function(e,t){var n=t.id,t=t.size;return e[t]||(e[t]=[]),e[t].push(n),e},{});this._order=Object.keys(n).sort(function(e,t){return t-e}).reduce(function(e,t){return e.concat(n[t])},[])}},{key:"_addNewActionConfig",value:function(e,t){var n=e.prefix,o=e.sequenceLength,i=e.id,r=e.keyDictionary,s=e.size,a=e.keyEventType,e=e.actionName;this._setCombinationMatcher(i,{prefix:n,sequenceLength:o,id:i,keyDictionary:r,size:s,events:{}}),this._addHandlerToActionConfig(i,{keyEventType:a,actionName:e,handler:t})}},{key:"_addHandlerToActionConfig",value:function(e,t){var n=t.keyEventType,o=t.actionName,i=t.handler,t=this._getCombinationMatcher(e);this._setCombinationMatcher(e,_objectSpread2(_objectSpread2({},t),{},{events:_objectSpread2(_objectSpread2({},t.events),{},_defineProperty({},n,{actionName:o,handler:i}))}))}},{key:"_setCombinationMatcher",value:function(e,t){this._actionConfigs[e]=t}},{key:"_getCombinationMatcher",value:function(e){return this._actionConfigs[e]}},{key:"_includesMatcherForCombination",value:function(e){return!!this._getCombinationMatcher(e)}}]),e}();function canBeMatched(e,t){var n=size(t.keyDictionary),t=new KeyCombinationIterator(e);return Configuration.option("allowCombinationSubmatches")||keyUpIsBeingHidden(e)?t.numberOfKeys>=n:t.numberOfKeys===n}function keyUpIsBeingHidden(e){return!!e.isKeyStillPressed("Meta")&&new KeyCombinationIterator(e).some(function(e){return keyupIsHiddenByCmd(e)})}function updateIndexCounters(e,t){for(var n=0,o=!0;o&&n<e.length;){var i=(indexFromEnd(e,n)+1)%(indexFromEnd(t,n)||1);(o=0==(e[e.length-(n+1)]=i))&&n++}return n===e.length}var KeyHistoryMatcher=function(){function e(){_classCallCheck(this,e),this._combinationMatchers={},this._eventRecord=KeyEventStateArrayManager.newRecord()}return _createClass(e,[{key:"addMatch",value:function(e,t){this._getOrCreateCombinationMatcher(e.prefix).addMatch(e,t),KeyEventStateArrayManager.setBit(this._eventRecord,e.keyEventType,KeyEventState.seen),(!this.longestSequence||this.longestSequence<e.sequenceLength)&&(this.longestSequence=e.sequenceLength)}},{key:"findMatch",value:function(e,t,n){var o=this._findCombinationMatcher(e);return o?o.findMatch(e.currentCombination,e.currentCombination.getNormalizedKeyName(t),n):null}},{key:"hasMatchesForEventType",value:function(e){return!!this._eventRecord[e]}},{key:"toJSON",value:function(){var o=this;return Object.keys(this._combinationMatchers).reduce(function(e,t){var n=o._combinationMatchers[t];return e[t]=n.toJSON(),e},{})}},{key:"_getOrCreateCombinationMatcher",value:function(e){return lazyLoadAttribute(this._combinationMatchers,e,function(){return new KeyCombinationMatcher})}},{key:"_findCombinationMatcher",value:function(e){e=e.getPreviousCombinations(this.longestSequence-1);if(0===e.length)return this._combinationMatchers[""];var n=e.map(function(e){return e.ids}),t=n.map(function(e){return e.length}),o=new Array(n.length).fill(0);do{var i=o.map(function(e,t){return n[t][e]}).join(" ");if(this._combinationMatchers[i])return this._combinationMatchers[i]}while(!updateIndexCounters(o,t));return this._combinationMatchers[""]}}]),e}();function printComponent(e){return JSON.stringify(e,componentAttributeSerializer,4)}function componentAttributeSerializer(e,t){return"function"==typeof t?t.toString():t}function describeKeyEventType(e){switch(parseInt(e,10)){case 0:return"keydown";case 1:return"keypress";default:return"keyup"}}var ActionResolver=function(){function r(e,t,n){_classCallCheck(this,r),this.logger=n,this._eventStrategy=t,this._keyMapMatchers=[],this._unmatchedHandlerStatus=[],this._handlersDictionary={},this._keySequencesDictionary={};for(var o=e.iterator;o.next();){var i=o.getComponent().handlers;this._unmatchedHandlerStatus.push([Object.keys(i).length,{}]),this._keyMapMatchers.push(new KeyHistoryMatcher)}this._componentList=e,this._componentListIterator=e.iterator}return _createClass(r,[{key:"getKeyHistoryMatcher",value:function(e){if(this._componentHasUnmatchedHandlers(e))for(;this._componentListIterator.next();)this._addHandlersFromComponent(),this._addActionsFromComponent();return this._getKeyHistoryMatcher(e)}},{key:"componentHasActionsBoundToEventType",value:function(e,t){return this.getKeyHistoryMatcher(e).hasMatchesForEventType(t)}},{key:"findMatchingKeySequenceInComponent",value:function(e,t,n,o){return this.componentHasActionsBoundToEventType(e,o)?this.getKeyHistoryMatcher(e).findMatch(t,n,o):null}},{key:"callClosestMatchingHandler",value:function(e,t,n,o,i){for(;i<=o;){this.getKeyHistoryMatcher(i);var r=this._eventStrategy.componentList.getAtPosition(i).componentId,s=this._eventStrategy.keyHistory,a=s.currentCombination,s=this.findMatchingKeySequenceInComponent(i,s,t,n);if(s)return this._handleMatchFound(a,s,n,r,e,i),!0;this._handleMatchNotFound(a,i,n,r),i++}}},{key:"_handleMatchNotFound",value:function(e,t,n,o){new KeyCombinationDecorator(e);this.componentHasActionsBoundToEventType(t,n)}},{key:"_handleMatchFound",value:function(e,t,n,o,i,r){new KeyCombinationDecorator(e);n=t.events[n];Configuration.option("allowCombinationSubmatches")&&KeyCombinationSerializer.serialize(t.keyDictionary),n.handler(i),Configuration.option("stopEventPropagationAfterHandling")&&this._eventStrategy.stopEventPropagation(i,r)}},{key:"_getKeyHistoryMatcher",value:function(e){return this._keyMapMatchers[e]}},{key:"_addActionsFromComponent",value:function(){var t=this,n=this._componentListIterator.getComponent().actions;Object.keys(n).forEach(function(e){t._buildActionMatchers(e,n[e])})}},{key:"_buildActionMatchers",value:function(n,e){var o=this,t=this._positionsOfComponentsWithHandlersFor(n);return!!t&&(this._registerActionWithMatcher(t,n,e),t.forEach(function(e){var t=o._getUnmatchedHandlerStatus(e),e=t[1];e[n]||(e[n]=!0,t[0]--)}),!0)}},{key:"_positionsOfComponentsWithHandlersFor",value:function(e){return this._handlersDictionary[e]}},{key:"_registerActionWithMatcher",value:function(e,t,n){var i=this,r=e[0],s=this._componentList.getAtPosition(r).handlers[t],a=this._getKeyHistoryMatcher(r);return n.forEach(function(e){var t=e.prefix,n=e.id,o=e.keyEventType,n=[t,n].join(" ");if(i._isClosestHandlerAlreadyFoundFor(n,o))return!1;a.addMatch(e,s),i._recordHandlerFoundFor(n,[r,o])}),!0}},{key:"_addHandlersFromComponent",value:function(){var t=this,e=this._componentListIterator.getComponent().handlers;Object.keys(e).forEach(function(e){t._addHandler(e)})}},{key:"_addHandler",value:function(e){lazyLoadAttribute(this._handlersDictionary,e,[]),this._handlersDictionary[e].push(this._componentListIterator.position)}},{key:"_recordHandlerFoundFor",value:function(e,t){lazyLoadAttribute(this._keySequencesDictionary,e,[]),this._keySequencesDictionary[e].push(t)}},{key:"_componentHasUnmatchedHandlers",value:function(e){return 0<this._getUnmatchedHandlerStatus(e)[0]}},{key:"_getUnmatchedHandlerStatus",value:function(e){return this._unmatchedHandlerStatus[e]}},{key:"_isClosestHandlerAlreadyFoundFor",value:function(e,t){return(this._keySequencesDictionary[e]||[]).some(function(e){return e[1]===t})}}]),r}(),AbstractKeyEventStrategy=function(){function t(){var e=1<arguments.length?arguments[1]:void 0;_classCallCheck(this,t),this.logger=null,this.componentId=-1,this.keyEventManager=e,this.componentTree=new ComponentTree,this._simulator=null,this._reset(),this.resetKeyHistory()}return _createClass(t,[{key:"_reset",value:function(){this.componentList=new ComponentOptionsList,this._actionResolver=null}},{key:"_recalculate",value:function(){this._actionResolver=null,this.keyHistory.maxLength=this.componentList.longestSequence}},{key:"keyHistory",get:function(){var e=this;return lazyLoadAttribute(this,"_keyHistory",function(){return e._newKeyHistory()})}},{key:"actionResolver",get:function(){var e=this;return lazyLoadAttribute(this,"_actionResolver",function(){return new ActionResolver(e.componentList,e,e.logger)})}},{key:"resetKeyHistory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._simulator&&this._simulator.clear(),this.keyHistory.any()&&!e.force?this._keyHistory=new KeyHistory({maxLength:this.componentList.longestSequence},new KeyCombination(this)):this._keyHistory=this._newKeyHistory()}},{key:"_newKeyHistory",value:function(){return new KeyHistory({maxLength:this.componentList.longestSequence})}},{key:"registerKeyMap",value:function(e){return this.componentId+=1,this.componentTree.add(this.componentId,e),this.componentId}},{key:"reregisterKeyMap",value:function(e,t){this.componentTree.update(e,t)}},{key:"registerComponentMount",value:function(e,t){this.componentTree.setParent(e,t)}},{key:"deregisterKeyMap",value:function(e){this.componentTree.remove(e),this.componentTree.isRootId(e)&&this.componentTree.clearRootId()}},{key:"_addComponent",value:function(e){this.componentList.add(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},4<arguments.length?arguments[4]:void 0),this._recalculate(),this.logger.logComponentOptions(e,this.componentList.getById(e))}},{key:"_updateComponent",value:function(e,t,n,o){this.componentList.update(e,t,n,o),this._recalculate(),this.logger.logComponentOptions(e,this.componentList.getById(e))}},{key:"currentCombination",get:function(){return this.keyHistory.currentCombination}},{key:"_describeCurrentCombination",value:function(){return new KeyCombinationDecorator(this.currentCombination).describe()}},{key:"_recordKeyDown",value:function(e,t,n){var o=stateFromEvent(e),e=this.currentCombination;e.isKeyIncluded(t)||e.isEnding?this._startAndLogNewKeyCombination(n,t,o):this._recordNewKeyInCombination(t,KeyEventType.keydown,o,n)}},{key:"_startAndLogNewKeyCombination",value:function(e,t,n){this.keyHistory.startNewKeyCombination(t,n),this.logger.logKeyHistory(this.keyHistory,e)}},{key:"_recordNewKeyInCombination",value:function(e,t,n,o){this.keyHistory.addKeyToCurrentCombination(e,t,n),this.logger.logKeyHistory(this.keyHistory,o)}},{key:"_isIgnoringRepeatedEvent",value:function(e,t,n,o){return!(!e.repeat||!Configuration.option("ignoreRepeatedEventsWhenKeyHeldDown"))&&(this.logger.logIgnoredKeyEvent(e,t,n,"it was a repeated event",o),!0)}}]),t}();function getEventCharCode(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,32<=(t=10===t?13:t)||13===t?t:0}var normalizeKey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"};function reactsGetEventKey(e){if(e.key){var t=normalizeKey[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"!==e.type)return"keydown"===e.type||"keyup"===e.type?translateToKey[e.keyCode]||"Unidentified":"";e=getEventCharCode(e);return 13===e?"Enter":String.fromCharCode(e)}function keyNameFromEvent(e){var t=Configuration.option("customKeyCodes"),n=e.keyCode||e.charCode;return hasKey(t,n)?t[n]:e.nativeEvent?e.key:reactsGetEventKey(e)}function getKeyName(e){e=keyNameFromEvent(e);return"+"===e?"plus":e}function isCmdKey(e){return"Meta"===e}function describeKeyEvent(e,t,n){n="'".concat(t,"' ").concat(describeKeyEventType(n));return e.simulated?"(simulated) ".concat(n):n}var EventResponse={unseen:0,ignored:1,seen:2,recorded:3,handled:4},KeyEventCounter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"id",get:function(){return lazyLoadAttribute(this,"_id",0),this._id}},{key:"incrementId",value:function(){this._id=this.id+1}}]),e}(),EventPropagator=function(){function n(e){_classCallCheck(this,n),this._componentList=e,this._previousPropagation=null,this._reset()}return _createClass(n,[{key:"_reset",value:function(){this.previousPosition=-1,this._position=-1,this._actionHandled=!1,this._ignoreEvent=!1,this._observeIgnoredEvents=!1,this._stopping=!1,this._componentId=null,this._key=null,this._type=null}},{key:"isFirstPropagationStep",value:function(){var e=this.previousPosition;return-1===e||e>=this._position}},{key:"isForKey",value:function(e){return this._key===e}},{key:"isForEventType",value:function(e){return this._type===e}},{key:"startNewPropagationStep",value:function(e,t,n,o){return this._position=this._componentList.getPositionById(e),this._componentId=e,this.isFirstPropagationStep()&&(KeyEventCounter.incrementId(),this._key=t.key,this._type=o),!t.repeat||!Configuration.option("ignoreRepeatedEventsWhenKeyHeldDown")||(this.ignoreEvent(t),!1)}},{key:"finishPropagationStep",value:function(){this.isStopped()||this._componentList.isRoot(this._componentId)?(this._previousPropagation=this._clone(),this._reset()):this.previousPosition=this._position}},{key:"previousPropagation",get:function(){var e=this;return lazyLoadAttribute(this,"_previousPropagation",function(){return e._clone({copyState:!1})})}},{key:"observeIgnoredEvents",value:function(){this._observeIgnoredEvents=!0}},{key:"ignoreEvent",value:function(e){return this._ignoreEvent=!0,!(!this.isIgnoringEvent()||!Configuration.option("stopEventPropagationAfterIgnoring"))&&(this.stop(e),this.finishPropagationStep(),!0)}},{key:"isIgnoringEvent",value:function(){return!this._observeIgnoredEvents&&this._ignoreEvent}},{key:"isStopped",value:function(){return this._stopping}},{key:"stop",value:function(e){return!this.isStopped()&&(this._stopping=!0,e.simulated||e.stopPropagation(),!0)}},{key:"isPendingPropagation",value:function(){var e=this.previousPosition;return-1!==e&&e+1<this._position}},{key:"isHandled",value:function(){return this._actionHandled}},{key:"setHandled",value:function(){this._actionHandled=!0}},{key:"_clone",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).copyState,t=void 0===e||e,e=new n(this._componentList);return e.logger=this.logger,t&&Object.assign(e,this),e}}]),n}();function hasKeyPressEvent(e){return!isNonPrintableKeyName(e)}var AbstractKeyEventSimulator=function(){function t(e){_classCallCheck(this,t),this._keyEventStrategy=e,this.clear()}return _createClass(t,[{key:"clear",value:function(){this.keypressEventsToSimulate=[],this.keyupEventsToSimulate=[]}},{key:"cloneAndMergeEvent",value:function(n,e){return _objectSpread2(_objectSpread2({},Object.keys(ModifierFlagsDictionary).reduce(function(e,t){return e[t]=n[t],e},{})),e)}},{key:"_shouldSimulate",value:function(e,t){var n=hasKeyPressEvent(t),o=this._keyEventStrategy.currentCombination;return e===KeyEventType.keypress?!n||n&&o.isKeyStillPressed("Meta"):e===KeyEventType.keyup&&(keyupIsHiddenByCmd(t)&&o.isKeyReleased("Meta"))}}]),t}(),FocusOnlyKeyEventSimulator=function(){_inherits(t,AbstractKeyEventSimulator);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"handleKeyPressSimulation",value:function(e){this._handleEventSimulation("keypressEventsToSimulate","simulatePendingKeyPressEvents",_objectSpread2({eventType:KeyEventType.keypress},e))}},{key:"handleKeyUpSimulation",value:function(e){this._handleEventSimulation("keyupEventsToSimulate","simulatePendingKeyUpEvents",_objectSpread2({eventType:KeyEventType.keyup},e))}},{key:"_handleEventSimulation",value:function(e,t,n){var o=n.event,i=n.eventType,r=n.key,s=n.focusTreeId,a=n.componentId,n=n.options;this._shouldSimulate(i,r)&&Configuration.option("simulateMissingKeyPressEvents")&&(r=this.cloneAndMergeEvent(o,{key:r,simulated:!0}),this[e].push({event:r,focusTreeId:s,componentId:a,options:n})),(this._keyEventStrategy.componentList.isRoot(a)||this._keyEventStrategy.eventPropagator.isStopped())&&this._shouldSimulateEventsImmediately()&&this._keyEventStrategy[t]()}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulatePendingKeyEvents("keypressEventsToSimulate","handleKeyPress")}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulatePendingKeyEvents("keyupEventsToSimulate","handleKeyUp")}},{key:"_simulatePendingKeyEvents",value:function(e,i){var r=this;0<this[e].length&&KeyEventCounter.incrementId(),this[e].forEach(function(e){var t=e.event,n=e.focusTreeId,o=e.componentId,e=e.options;r._keyEventStrategy[i](t,n,o,e)}),this[e]=[]}},{key:"_shouldSimulateEventsImmediately",value:function(){return this._keyEventStrategy.shouldSimulateEventsImmediately()}}]),t}(),FocusTree=function(){function e(){_classCallCheck(this,e),this.id=0}return _createClass(e,[{key:"isNewerThan",value:function(e){return this.id!==e}},{key:"new",value:function(){this.id+=1}}]),e}(),EventStrategyLogger=function(){_inherits(o,Logger);var n=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=n.call(this,e))._eventStrategy=t,e}return _createClass(o,[{key:"nonKeyEventPrefix",value:function(e){return this.keyEventPrefix(e,_objectSpread2(_objectSpread2({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}),{},{eventId:!1}))}},{key:"logComponentOptions",value:function(e,t){this.verbose(this.nonKeyEventPrefix(e),"New component options:\n",printComponent(t))}},{key:"logKeyHistory",value:function(e,t){this.verbose(this.keyEventPrefix(t),"Key history: ".concat(printComponent(e.toJSON()),"."))}}]),o}(),FocusOnlyLogger=function(){_inherits(a,EventStrategyLogger);var e=_createSuper(a);function a(){return _classCallCheck(this,a),e.apply(this,arguments)}return _createClass(a,[{key:"keyEventPrefix",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=_get(_getPrototypeOf(a.prototype),"constructor",this).logIcons,i=_get(_getPrototypeOf(a.prototype),"constructor",this).eventIcons,r=_get(_getPrototypeOf(a.prototype),"constructor",this).componentIcons,s="HotKeys (";!1!==n.focusTreeId&&(t=(isUndefined(n.focusTreeId)?this._eventStrategy:n).focusTreeId,s+="F".concat(t).concat(o[t%o.length],"-")),s+="C".concat(e).concat(r[e%r.length]);e=this._eventStrategy.componentList.getPositionById(e);return isUndefined(e)||(s+="-P".concat(e).concat(r[e%r.length])),!1!==n.eventId&&(n=isUndefined(n.eventId)?KeyEventCounter.id:n.eventId,s+="-E".concat(n).concat(i[n%i.length])),"".concat(s,"):")}},{key:"logIgnoredKeyEvent",value:function(e,t,n,o,i){this.logIgnoredEvent(describeKeyEvent(e,t,n),o,i)}},{key:"logIgnoredEvent",value:function(e,t,n){this.debug(this.keyEventPrefix(n),"Ignored ".concat(e," because ").concat(t,"."))}},{key:"logAlreadySimulatedEvent",value:function(e,t,n,o){this.logIgnoredKeyEvent(e,t,n,"it was not expected, and has already been simulated",o)}}]),a}(),FocusOnlyKeyEventStrategy=function(){_inherits(o,AbstractKeyEventStrategy);var n=_createSuper(o);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return _classCallCheck(this,o),(t=n.call(this,e,t)).logger=new FocusOnlyLogger(e.logLevel||"warn",_assertThisInitialized(t)),t.eventPropagator.logger=t.logger,t.focusTree=new FocusTree,t._simulator=new FocusOnlyKeyEventSimulator(_assertThisInitialized(t)),t}return _createClass(o,[{key:"_reset",value:function(){_get(_getPrototypeOf(o.prototype),"_reset",this).call(this),this._simulator&&this._simulator.clear(),this.focusTree&&this.focusTree.new(),this.eventPropagator=new EventPropagator(this.componentList),this.eventPropagator.logger=this.logger}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;if(this.resetOnNextFocus&&(this._reset(),this.resetOnNextFocus=!1),!this.componentList.containsId(e))return this._addComponent(e,t,n,"Focused",o),this.focusTree.id}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;!this.focusTree.isNewerThan(e)&&this.componentList.containsId(t)&&this._updateComponent(t,n,o,i)}},{key:"disableHotKeys",value:function(e,t){return this.resetOnNextFocus=!0,this.eventPropagator.isPendingPropagation()}},{key:"handleKeyDown",value:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=getKeyName(e);return this.focusTree.isNewerThan(t)?(this.logger.logIgnoredKeyEvent(e,i,KeyEventType.keydown,"it had an old focus tree id: ".concat(t),n),this.eventPropagator.ignoreEvent(e),!0):(this._isIgnoringRepeatedEvent(e,i,KeyEventType.keydown,n)||this.eventPropagator.startNewPropagationStep(n,e,i,KeyEventType.keydown)&&(this._howToHandleKeyEvent(e,t,n,i,o,KeyEventType.keydown)===EventResponse.handled&&(this._recordKeyDown(e,i,n),this._callHandlerIfActionNotHandled(e,i,KeyEventType.keydown,n,t)),this._simulator.handleKeyPressSimulation({event:e,key:i,focusTreeId:t,componentId:n,options:o}),this.eventPropagator.finishPropagationStep()),!1)}},{key:"_howToHandleKeyEvent",value:function(e,t,n,o,i,r){if(this.eventPropagator.isFirstPropagationStep()){if(i.ignoreEventsCondition(e)&&this.eventPropagator.ignoreEvent(e))return this._eventIsToBeIgnored(e,n,o,r);this.currentCombination.resolveModifierFlagDiscrepancies(e,o,r)}else if(this.eventPropagator.isIgnoringEvent())return this._eventIsToBeIgnored(e,n,o,r);return EventResponse.handled}},{key:"_eventIsToBeIgnored",value:function(e,t,n,o){return this.logger.logIgnoredKeyEvent(e,n,o,"ignoreEventsFilter rejected it",t),EventResponse.ignored}},{key:"handleKeyPress",value:function(e,t,n,o){var i=getKeyName(e);if(this._isIgnoringRepeatedEvent(e,i,KeyEventType.keypress,n))return!1;if(this.currentCombination.isKeyPressSimulated(i))return this._ignoreAlreadySimulatedEvent(e,i,KeyEventType.keypress,n),!1;var r=this.focusTree.isNewerThan(t);return this.eventPropagator.startNewPropagationStep(n,e,i,KeyEventType.keypress)&&(o=this._howToHandleKeyEvent(e,t,n,i,o,KeyEventType.keypress),this.eventPropagator.isFirstPropagationStep(n)&&this.currentCombination.isKeyIncluded(i)&&this._recordNewKeyInCombination(i,KeyEventType.keypress,stateFromEvent(e),n),o===EventResponse.handled&&this._callHandlerIfActionNotHandled(e,i,KeyEventType.keypress,n,t),this.eventPropagator.finishPropagationStep()),r}},{key:"handleKeyUp",value:function(e,t,n,o){var i=getKeyName(e);if(this.currentCombination.isKeyUpSimulated(i))return this._ignoreAlreadySimulatedEvent(e,i,KeyEventType.keyup,n),!1;var r,s=this.focusTree.isNewerThan(t),a=this.eventPropagator;return a.startNewPropagationStep(n,e,i,KeyEventType.keyup)&&(r=this._howToHandleKeyEvent(e,t,n,i,o,KeyEventType.keyup),a.isFirstPropagationStep(n)&&this.currentCombination.isKeyIncluded(i)&&this._recordNewKeyInCombination(i,KeyEventType.keyup,stateFromEvent(e),n),r===EventResponse.handled&&this._callHandlerIfActionNotHandled(e,i,KeyEventType.keyup,n,t),this._simulateKeyUpEventsHiddenByCmd(e,i,t,n,o),a.finishPropagationStep()),s}},{key:"_ignoreAlreadySimulatedEvent",value:function(e,t,n,o){this.logger.logAlreadySimulatedEvent(e,t,n,o),this.eventPropagator.ignoreEvent(e)}},{key:"closeHangingKeyCombination",value:function(e,t){var n=this.currentCombination;n.isKeyIncluded(e)&&!n.isEventTriggered(e,t)&&n.setKeyState(e,t,KeyEventState.simulated)}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e,n,o,i){var r=this;isCmdKey(e)&&new KeyCombinationIterator(this.currentCombination).forEachKey(function(e){isCmdKey(e)||r._simulator.handleKeyUpSimulation({event:t,key:e,focusTreeId:n,componentId:o,options:i})})}},{key:"stopEventPropagation",value:function(e,t){this.eventPropagator.stop(e)}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulator.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulator.simulatePendingKeyUpEvents()}},{key:"shouldSimulateEventsImmediately",value:function(){return!this.keyEventManager.isGlobalListenersBound()}},{key:"_callHandlerIfActionNotHandled",value:function(e,t,n,o,i){var r,s,a=describeKeyEventType(n),u=this._describeCurrentCombination();this.componentList.anyActionsForEventType(n)?this.eventPropagator.isHandled()?this.logger.logIgnoredEvent("'".concat(u,"' ").concat(a),"it has already been handled",o):(r=this.eventPropagator.previousPosition,s=this.componentList.getPositionById(o),this.actionResolver.callClosestMatchingHandler(e,t,n,s,-1===r?0:r)&&this.eventPropagator.setHandled()):this.logger.logIgnoredEvent("'".concat(u,"' ").concat(a),"it doesn't have any ".concat(a," handlers"),o)}}]),o}();function findableCollectionContains(e,t,n){return n.stringifyFirst?!isUndefined(e.find(function(e){return e.toString()===t.toString()})):-1!==e.indexOf(t)}function nonCollectionContains(e,t,n){return n.stringifyFirst?e.toString()===t.toString():e===t}function contains(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(e)||isString(e)?findableCollectionContains(e,t,n):isObject(e)?hasKey(e,t):nonCollectionContains(e,t,n)}var GlobalKeyEventSimulator=function(){_inherits(t,AbstractKeyEventSimulator);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"handleKeyPressSimulation",value:function(e){this._handleEventSimulation("handleKeyPress",_objectSpread2({eventType:KeyEventType.keypress},e))}},{key:"handleKeyUpSimulation",value:function(e){this._handleEventSimulation("handleKeyUp",_objectSpread2({eventType:KeyEventType.keyup},e))}},{key:"_handleEventSimulation",value:function(e,t){var n=t.event,o=t.eventType,t=t.key;this._shouldSimulate(o,t)&&Configuration.option("simulateMissingKeyPressEvents")&&(t=this.cloneAndMergeEvent(n,{key:t,simulated:!0}),this._keyEventStrategy[e](t))}}]),t}();function capitalize(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}function normalizeEventName(e){return"".concat(capitalize(e.slice(0,3))).concat(capitalize(e.slice(3)))}var GlobalEventListenerAdaptor=function(){function n(e,t){t=t.logger;_classCallCheck(this,n),this._listenersBound=!1,this.logger=t,this._eventStrategy=e}return _createClass(n,[{key:"isListenersBound",value:function(){return this._listenersBound}},{key:"unbindListeners",value:function(){var t=this;objectValues(KeyEventType).forEach(function(e){e=describeKeyEventType(e);delete document["on".concat(e)],t._logHandlerStateChange("Removed",e)}),this._listenersBound=!1}},{key:"bindListeners",value:function(){var n=this;objectValues(KeyEventType).forEach(function(e){var t=describeKeyEventType(e);document["on".concat(t)]=function(e){n._eventStrategy["handle".concat(normalizeEventName(t))](e)},n._logHandlerStateChange("Bound",t)}),this._listenersBound=!0}},{key:"_logHandlerStateChange",value:function(e,t){}}]),n}(),GlobalLogger=function(){_inherits(r,EventStrategyLogger);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r,[{key:"keyEventPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=_get(_getPrototypeOf(r.prototype),"constructor",this).eventIcons,o=_get(_getPrototypeOf(r.prototype),"constructor",this).componentIcons,i="HotKeys (GLOBAL";if(!isUndefined(e))return"".concat(i,"-C").concat(e).concat(o[e%o.length],"):");if(!1===t.eventId)return"".concat(i,"):");t=isUndefined(t.eventId)?KeyEventCounter.id:t.eventId;return"".concat(i,"-E").concat(t).concat(n[t%n.length],"):")}},{key:"logIgnoredKeyEvent",value:function(e,t,n,o,i){this.logIgnoredEvent(describeKeyEvent(e,t,n),o,i)}},{key:"logIgnoredEvent",value:function(e,t,n){this.debug(this.keyEventPrefix(n),"Ignored ".concat(e," because ").concat(t,"."))}},{key:"logEventRejectedByFilter",value:function(e,t,n,o){this.logIgnoredKeyEvent(e,t,n,"ignoreEventsFilter rejected it",o)}},{key:"logEventAlreadySimulated",value:function(e,t,n,o){this.logIgnoredKeyEvent(e,t,n,"it was not expected, and has already been simulated",o)}}]),r}(),GlobalKeyEventStrategy=function(){_inherits(o,AbstractKeyEventStrategy);var n=_createSuper(o);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return _classCallCheck(this,o),(t=n.call(this,e,t)).logger=new GlobalLogger(e.logLevel||"warn",_assertThisInitialized(t)),t.eventOptions={ignoreEventsCondition:Configuration.option("ignoreEventsCondition")},t.listeners=new Registry,t._simulator=new GlobalKeyEventSimulator(_assertThisInitialized(t)),t._listenerAdaptor=new GlobalEventListenerAdaptor(_assertThisInitialized(t),{logger:t.logger}),t}return _createClass(o,[{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;this.eventOptions=4<arguments.length?arguments[4]:void 0,this._addComponent(e,t,n,"Mounted",o)}},{key:"updateEnabledHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;this.eventOptions=4<arguments.length?arguments[4]:void 0,this._updateComponent(e,t,n,o)}},{key:"disableHotKeys",value:function(e){this.componentList.remove(e),this._recalculate()}},{key:"_recalculate",value:function(){_get(_getPrototypeOf(o.prototype),"_recalculate",this).call(this),this._updateDocumentHandlers()}},{key:"_updateDocumentHandlers",value:function(){var e=this._shouldListenersBeBound(),t=this.isListenersBound();!t&&e?this._listenerAdaptor.bindListeners():t&&!e&&this._listenerAdaptor.unbindListeners()}},{key:"isListenersBound",value:function(){return this._listenerAdaptor.isListenersBound()}},{key:"_shouldListenersBeBound",value:function(){return 0!==this.componentList.length||this.listeners.get("keyCombination")}},{key:"handleKeyDown",value:function(e){var t,n=getKeyName(e);this._isIgnoringRepeatedEvent(e,n,KeyEventType.keydown)||(this.currentCombination.resolveModifierFlagDiscrepancies(e,n,KeyEventType.keydown),(t=this._howReactAppRespondedTo(e,n,KeyEventType.keydown))===EventResponse.unseen&&this.eventOptions.ignoreEventsCondition(e)?this.logger.logEventRejectedByFilter(e,n,KeyEventType.keydown):(t!==EventResponse.ignored&&this._recordKeyDown(e,n),this._callHandlerIfNeeded(t,e,n,KeyEventType.keydown),this.keyEventManager.simulatePendingKeyPressEvents(),this._simulator.handleKeyPressSimulation({event:e,key:n})))}},{key:"_howReactAppRespondedTo",value:function(e,t,n){var o=this.keyEventManager.reactAppHistoryWithEvent(t,n);switch(o){case EventResponse.handled:this.logger.logIgnoredKeyEvent(e,t,n,"React app has already handled it");break;case EventResponse.ignored:this.logger.logIgnoredKeyEvent(e,t,n,"React app has declared it should be ignored");break;case EventResponse.seen:break;default:KeyEventCounter.incrementId()}return o}},{key:"handleKeyPress",value:function(e){var t,n=getKeyName(e);this._isIgnoringRepeatedEvent(e,n,KeyEventType.keypress)||(this.currentCombination.isKeyPressSimulated(n)?this.logger.logEventAlreadySimulated(e,n,KeyEventType.keypress):(t=this._howReactAppRespondedTo(e,n,KeyEventType.keypress),this.currentCombination.isKeyIncluded(n)&&this._recordNewKeyInCombination(n,KeyEventType.keypress,stateFromEvent(e)),t===EventResponse.unseen&&(this.keyEventManager.closeHangingKeyCombination(n,KeyEventType.keypress),this.eventOptions.ignoreEventsCondition(e))?this.logger.logEventRejectedByFilter(e,n,KeyEventType.keypress):this._callHandlerIfNeeded(t,e,n,KeyEventType.keypress)))}},{key:"_callHandlerIfNeeded",value:function(e,t,n,o){contains([EventResponse.ignored,EventResponse.handled],e)||this._callHandlerIfExists(t,n,o)}},{key:"handleKeyUp",value:function(e){var t,n=getKeyName(e);this.currentCombination.isKeyUpSimulated(n)?this.logger.logEventAlreadySimulated(e,n,KeyEventType.keyup):(t=this._howReactAppRespondedTo(e,n,KeyEventType.keyup),this.currentCombination.isKeyIncluded(n)&&this._recordNewKeyInCombination(n,KeyEventType.keyup,stateFromEvent(e)),t===EventResponse.unseen?(this.keyEventManager.closeHangingKeyCombination(n,KeyEventType.keyup),this.eventOptions.ignoreEventsCondition(e)?this.logger.logIgnoredKeyEvent(e,n,KeyEventType.keyup,"ignoreEventsFilter rejected it"):this._callHandlerIfNeeded(t,e,n,KeyEventType.keyup)):this._callHandlerIfNeeded(t,e,n,KeyEventType.keyup),this._simulateKeyUpEventsHiddenByCmd(e,n),this._callKeyCombinationCallbackIfDefined())}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e){var n=this;isCmdKey(e)&&(this.keyEventManager.simulatePendingKeyUpEvents(),new KeyCombinationIterator(this.currentCombination).forEachKey(function(e){isCmdKey(e)||n._simulator.handleKeyUpSimulation({event:t,key:e})}))}},{key:"_callKeyCombinationCallbackIfDefined",value:function(){var e;this.listeners.get("keyCombination")&&this.currentCombination.hasEnded()&&(e=new KeyCombinationDecorator(this.currentCombination),this.listeners.get("keyCombination")({keys:e.asKeyDictionary(),id:e.describe()}))}},{key:"_callHandlerIfExists",value:function(e,t,n){var o=describeKeyEventType(n),i=this._describeCurrentCombination();this.componentList.anyActionsForEventType(n)?this._callClosestMatchingHandler(e,t,n):this.logger.logIgnoredEvent("'".concat(i,"' ").concat(o),"it doesn't have any ".concat(o," handlers"))}},{key:"_callClosestMatchingHandler",value:function(e,t,n){for(var o=this.componentList.iterator;o.next();)if(this.actionResolver.callClosestMatchingHandler(e,t,n,o.position,0))return}},{key:"stopEventPropagation",value:function(e,t){e.simulated||e.stopPropagation()}},{key:"addKeyCombinationListener",value:function(t){function n(){e.listeners.remove("keyCombination")}var e=this;return this.listeners.set("keyCombination",function(e){t(e),n()}),this._updateDocumentHandlers(),n}}]),o}();function copyAttributes(t,n,e){return e.forEach(function(e){hasKey(t,e)&&(n[e]=t[e])}),n}var SEQUENCE_ATTRIBUTES=["sequence","action"],KEYMAP_ATTRIBUTES=["name","description","group"];function createSequenceFromConfig(e){return arrayFrom(e).map(function(e){return isObject(e)?copyAttributes(e,{},SEQUENCE_ATTRIBUTES):{sequence:e}})}function normalizeActionDefinition(e,t,n){e=e[t];n[t]={},isObject(e)?hasKey(e,"sequences")?(copyAttributes(e,n[t],KEYMAP_ATTRIBUTES),n[t].sequences=createSequenceFromConfig(e.sequences)):(copyAttributes(e,n[t],KEYMAP_ATTRIBUTES),n[t].sequences=[copyAttributes(e,{},SEQUENCE_ATTRIBUTES)]):n[t].sequences=createSequenceFromConfig(e)}var ApplicationKeyMapBuilder=function(){function t(e){_classCallCheck(this,t),this._componentTree=e}return _createClass(t,[{key:"build",value:function(){return this._componentTree.hasRoot()?this._build([this._componentTree.rootId],{}):{}}},{key:"_build",value:function(e,o){var i=this;return e.forEach(function(e){var t=i._componentTree.get(e),e=t.childIds,n=t.keyMap;n&&Object.keys(n).forEach(function(e){normalizeActionDefinition(n,e,o)}),i._build(e,o)}),o}}]),t}(),KeyEventManager=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var t=Configuration.option("logLevel");this.logger=e.logger||new Logger(t),this.focusOnlyEventStrategy=new FocusOnlyKeyEventStrategy({configuration:e,logLevel:t},this),this.globalEventStrategy=new GlobalKeyEventStrategy({configuration:e,logLevel:t},this),this.mountedComponentsCount=0,this._blurHandler=this._clearKeyHistory.bind(this)}return _createClass(n,[{key:"applicationKeyMap",get:function(){return[this.globalEventStrategy,this.focusOnlyEventStrategy].reduce(function(e,t){t=new ApplicationKeyMapBuilder(t.componentTree).build();return _objectSpread2(_objectSpread2({},e),t)},{})}},{key:"registerComponentMount",value:function(e,t){return this._incrementComponentCount(),this.focusOnlyEventStrategy.registerComponentMount(e,t)}},{key:"registerComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"_incrementComponentCount",value:function(){var e=this.mountedComponentsCount;this.mountedComponentsCount+=1,0===e&&1===this.mountedComponentsCount&&window.addEventListener("blur",this._blurHandler)}},{key:"_decrementComponentCount",value:function(){var e=this.mountedComponentsCount;--this.mountedComponentsCount,1===e&&0===this.mountedComponentsCount&&window.removeEventListener("blur",this._blurHandler)}},{key:"_clearKeyHistory",value:function(){this.focusOnlyEventStrategy.resetKeyHistory({force:!0}),this.globalEventStrategy.resetKeyHistory({force:!0})}},{key:"registerGlobalComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"registerGlobalComponentMount",value:function(e,t){return this._incrementComponentCount(),this.globalEventStrategy.registerComponentMount(e,t)}},{key:"addKeyCombinationListener",value:function(e){return this.globalEventStrategy.addKeyCombinationListener(e)}},{key:"ignoreEvent",value:function(e){this.focusOnlyEventStrategy.eventPropagator.ignoreEvent(e)}},{key:"observeIgnoredEvents",value:function(e){this.focusOnlyEventStrategy.eventPropagator.observeIgnoredEvents(e)}},{key:"closeHangingKeyCombination",value:function(e,t){this.focusOnlyEventStrategy.closeHangingKeyCombination(e,t)}},{key:"reactAppHistoryWithEvent",value:function(e,t){var n=this.focusOnlyEventStrategy.eventPropagator.previousPropagation;return n.isForKey(e)&&n.isForEventType(t)?n.isHandled()?EventResponse.handled:n.isIgnoringEvent()?EventResponse.ignored:EventResponse.seen:EventResponse.unseen}},{key:"simulatePendingKeyPressEvents",value:function(){this.focusOnlyEventStrategy.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this.focusOnlyEventStrategy.simulatePendingKeyUpEvents()}},{key:"isGlobalListenersBound",value:function(){return this.globalEventStrategy.isListenersBound()}}],[{key:"getInstance",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return lazyLoadAttribute(this,"instance",function(){return new n(e)})}},{key:"getFocusOnlyEventStrategy",value:function(){return this.getInstance().focusOnlyEventStrategy}},{key:"getGlobalEventStrategy",value:function(){return this.getInstance().globalEventStrategy}}]),n}();function wrapPropInFunction(t,n){return"function"==typeof t?function(e){t(e),n(e)}:n}function getComponentOptions(){return{defaultKeyEvent:Configuration.option("defaultKeyEvent")}}function getEventOptions(){return{ignoreEventsCondition:Configuration.option("ignoreEventsCondition")}}var FocusOnlyComponentManager=function(){function n(e,t){t=t.keyMap;_classCallCheck(this,n),this._hotKeysOptions=e,this.id=KeyEventManager.getFocusOnlyEventStrategy().registerKeyMap(t),this.childContext={hotKeysParentId:this.id},this._focusTreeIds=[]}return _createClass(n,[{key:"focusTreeId",get:function(){return this._focusTreeIds[0]}},{key:"getComponentProps",value:function(e){var t=this,n={onFocus:wrapPropInFunction(e.onFocus,function(){return t.enableHotKeys(e)}),onBlur:wrapPropInFunction(e.onBlur,function(){return t.disableHotKeys(e)}),tabIndex:Configuration.option("defaultTabIndex")};return this._shouldBindKeyListeners(e)&&(n.onKeyDown=function(e){return t._delegateEventToManager(e,"handleKeyDown")},n.onKeyPress=function(e){return t._delegateEventToManager(e,"handleKeyPress")},n.onKeyUp=function(e){return t._delegateEventToManager(e,"handleKeyUp")}),n}},{key:"_shouldBindKeyListeners",value:function(e){return!isEmpty(this._getKeyMap(e))||e.root}},{key:"addHotKeys",value:function(e){KeyEventManager.getInstance().registerComponentMount(this.id,e)}},{key:"enableHotKeys",value:function(e){e.onFocus&&e.onFocus.apply(e,arguments);e=KeyEventManager.getFocusOnlyEventStrategy().enableHotKeys(this.id,this._getKeyMap(e),this._getHandlers(e),getComponentOptions());isUndefined(e)||this._focusTreeIdsPush(e),this._setFocused(!0)}},{key:"updateHotKeys",value:function(e){var t,n=KeyEventManager.getFocusOnlyEventStrategy();n.reregisterKeyMap(this.id,e.keyMap),!this._componentIsFocused()||!e.allowChanges&&Configuration.option("ignoreKeymapAndHandlerChangesByDefault")||(t=e.keyMap,e=e.handlers,n.updateEnabledHotKeys(this.focusTreeId,this.id,t,e,getComponentOptions()))}},{key:"disableHotKeys",value:function(e){e.onBlur&&e.onBlur.apply(e,arguments),KeyEventManager.getFocusOnlyEventStrategy().disableHotKeys(this.focusTreeId,this.id)||this._focusTreeIdsShift(),this._setFocused(!1)}},{key:"removeKeyMap",value:function(e){KeyEventManager.getFocusOnlyEventStrategy().deregisterKeyMap(this.id),KeyEventManager.getInstance().registerComponentUnmount(),this.disableHotKeys(e)}},{key:"_componentIsFocused",value:function(){return!0===this._focused}},{key:"_focusTreeIdsPush",value:function(e){this._focusTreeIds.push(e)}},{key:"_focusTreeIdsShift",value:function(){this._focusTreeIds.shift()}},{key:"_setFocused",value:function(e){this._focused=e}},{key:"_delegateEventToManager",value:function(e,t){KeyEventManager.getFocusOnlyEventStrategy()[t](e,this.focusTreeId,this.id,getEventOptions())&&this._focusTreeIdsShift()}},{key:"_mergeWithOptions",value:function(e,t){return _objectSpread2(_objectSpread2({},this._hotKeysOptions[e]||{}),t[e]||{})}},{key:"_getHandlers",value:function(e){return this._mergeWithOptions("handlers",e)}},{key:"_getKeyMap",value:function(e){return this._mergeWithOptions("keyMap",e)}}]),n}(),_excluded=["keyMap","handlers","allowChanges","root"],propTypes={keyMap:PropTypes.object,handlers:PropTypes.object,onFocus:PropTypes.func,onBlur:PropTypes.func,allowChanges:PropTypes.bool,root:PropTypes.bool};function provideWithContext(e){return backwardsCompatibleContext(e,{deprecatedAPI:{contextTypes:{hotKeysParentId:PropTypes.number},childContextTypes:{hotKeysParentId:PropTypes.number}},newAPI:{contextType:{hotKeysParentId:void 0}}})}function componentFactory(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e=function(){_inherits(o,React.PureComponent);var n=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=n.call(this,e))._manager=new FocusOnlyComponentManager(i,e),t}return _createClass(o,[{key:"componentDidMount",value:function(){this._manager.addHotKeys(this.context.hotKeysParentId)}},{key:"componentDidUpdate",value:function(){this._manager.updateHotKeys(this.props)}},{key:"componentWillUnmount",value:function(){this._manager.removeKeyMap(this.props)}},{key:"render",value:function(){var e=this.props,e=(e.keyMap,e.handlers,e.allowChanges,e.root,_objectWithoutProperties(e,_excluded));return React__default.createElement(t,_extends({hotKeys:this._manager.getComponentProps(this.props)},e))}}]),o}();return _defineProperty(e,"propTypes",propTypes),n}function withHotKeys(e){return provideWithContext(componentFactory(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}var _excluded$1=["hotKeys","innerRef","component"],HotKeysWrapper=function(){_inherits(t,React.Component);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=e.innerRef,o=e.component,e=_objectWithoutProperties(e,_excluded$1),o=o||Configuration.option("defaultComponent");return React__default.createElement(o,_objectSpread2(_objectSpread2({},t),{},{ref:n},e))}}]),t}(),HotKeys=withHotKeys(HotKeysWrapper);HotKeys.propTypes={innerRef:PropTypes.oneOfType([PropTypes.object,PropTypes.func])};var GlobalComponentManager=function(){function o(e){_classCallCheck(this,o),this.id=KeyEventManager.getGlobalEventStrategy().registerKeyMap(e),this.childContext={globalHotKeysParentId:this.id}}return _createClass(o,[{key:"addHotKeys",value:function(e,t){var n=e.keyMap,e=e.handlers,t=t.globalHotKeysParentId;KeyEventManager.getInstance().registerGlobalComponentMount(this.id,t),KeyEventManager.getGlobalEventStrategy().enableHotKeys(this.id,n,e,o._getComponentOptions(),o._getEventOptions())}},{key:"updateHotKeys",value:function(e){var t,n=KeyEventManager.getGlobalEventStrategy();n.reregisterKeyMap(this.id,e.keyMap),!e.allowChanges&&Configuration.option("ignoreKeymapAndHandlerChangesByDefault")||(t=e.keyMap,e=e.handlers,n.updateEnabledHotKeys(this.id,t,e,o._getComponentOptions(),o._getEventOptions()))}},{key:"removeKeyMap",value:function(){var e=KeyEventManager.getGlobalEventStrategy();e.deregisterKeyMap(this.id),e.disableHotKeys(this.id),KeyEventManager.getInstance().registerGlobalComponentUnmount()}}],[{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:Configuration.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:Configuration.option("ignoreEventsCondition")}}}]),o}(),GlobalHotKeys=function(){_inherits(o,React.Component);var n=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=n.call(this,e))._manager=new GlobalComponentManager(e.keyMap),t}return _createClass(o,[{key:"render",value:function(){return this.props.children||null}},{key:"componentDidMount",value:function(){this._manager.addHotKeys(this.props,this.context)}},{key:"componentDidUpdate",value:function(){this._manager.updateHotKeys(this.props)}},{key:"componentWillUnmount",value:function(){this._manager.removeKeyMap()}}]),o}();_defineProperty(GlobalHotKeys,"propTypes",{keyMap:PropTypes.object,handlers:PropTypes.object,allowChanges:PropTypes.bool});var GlobalHotKeys$1=backwardsCompatibleContext(GlobalHotKeys,{deprecatedAPI:{contextTypes:{globalHotKeysParentId:PropTypes.number},childContextTypes:{globalHotKeysParentId:PropTypes.number}},newAPI:{contextType:{globalHotKeysParentId:void 0}}}),HotKeysIgnoreOverrideManager=function(){function t(e){_classCallCheck(this,t),this._handleKeyEvent=this._handleKeyEvent.bind(this),this._eventManagerMethod=e}return _createClass(t,[{key:"getComponentProps",value:function(e){var t=this;return{onKeyDown:this._handleKeyEvent,onKeyPress:this._handleKeyEvent,onKeyUp:this._handleKeyEvent,onFocus:function(){return t._reloadDictionaries(e())}}}},{key:"_reloadDictionaries",value:function(e){var t=e.only,e=e.except;this._onlyDict=keyDictionary(t),this._exceptDict=keyDictionary(e)}},{key:"_handleKeyEvent",value:function(e){this._shouldIgnoreEvent(e)&&KeyEventManager.getInstance()[this._eventManagerMethod](e)}},{key:"_shouldIgnoreEvent",value:function(e){e=e.key;return isEmpty(this._onlyDict)?!!isEmpty(this._exceptDict)||!hasKey(this._exceptDict,e):isEmpty(this._exceptDict)?hasKey(this._onlyDict,e):hasKey(this._onlyDict,e)&&!hasKey(this._exceptDict,e)}}]),t}();function keyDictionary(e){return arrayFrom(e).reduce(function(e,t){var n=standardizeKeyName(t);if(!isValidKey(n))throw new InvalidKeyNameError(t);return dictionaryFrom([resolveAltShiftedAlias,resolveUnaltShiftedAlias,resolveShiftedAlias,resolveUnshiftedAlias,resolveAltedAlias,resolveUnaltedAlias],!0,function(e){return e(n)},e),e},{})}var _excluded$2=["only","except"],propTypes$1={only:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),except:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)])};function withHotKeysIgnoreOverride(o){var e,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},i=2<arguments.length?arguments[2]:void 0,n=e=function(){_inherits(n,React.PureComponent);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),(e=t.call(this,e))._manager=new HotKeysIgnoreOverrideManager(i),e}return _createClass(n,[{key:"render",value:function(){var e=this,t=this.props,t=(t.only,t.except,_objectWithoutProperties(t,_excluded$2));return React__default.createElement(o,_extends({hotKeys:this._manager.getComponentProps(function(){return e.props})},t))}}]),n}();return _defineProperty(e,"propTypes",propTypes$1),_defineProperty(e,"defaultProps",t),n}var _excluded$3=["hotKeys"];function overrideComponent(e){var t,n=t=function(){_inherits(t,React.Component);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=_objectWithoutProperties(e,_excluded$3),e=n.component||Configuration.option("defaultComponent");return React__default.createElement(e,_objectSpread2(_objectSpread2({},t),n))}}]),t}();return _defineProperty(t,"displayName",e),n}var IgnoreKeys=withHotKeysIgnoreOverride(overrideComponent("IgnoreKeys"),{},"ignoreEvent"),ObserveKeys=withHotKeysIgnoreOverride(overrideComponent("ObserveKeys"),{},"observeIgnoredEvents");function withIgnoreKeys(e){return withHotKeysIgnoreOverride(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"ignoreEvent")}function withObserveKeys(e){return withHotKeysIgnoreOverride(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"observeIgnoredEvents")}function configure(){Configuration.init(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}function getApplicationKeyMap(){return KeyEventManager.getInstance().applicationKeyMap}function recordKeyCombination(e){return KeyEventManager.getInstance().addKeyCombinationListener(e)}exports.GlobalHotKeys=GlobalHotKeys$1,exports.HotKeys=HotKeys,exports.IgnoreKeys=IgnoreKeys,exports.KeyEventManager=KeyEventManager,exports.ObserveKeys=ObserveKeys,exports.configure=configure,exports.getApplicationKeyMap=getApplicationKeyMap,exports.recordKeyCombination=recordKeyCombination,exports.withHotKeys=withHotKeys,exports.withIgnoreKeys=withIgnoreKeys,exports.withObserveKeys=withObserveKeys;
